/* ============================================
   XIWENAPP - SISTEMA DE DISEÑO GLOBAL
   ============================================ */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   ESTILOS BASE - TODO desde Tailwind Config
   ============================================ */

@layer base {
  * {
    @apply box-border m-0 p-0;
  }

  /* Focus global - Remover outline azul del navegador */
  *:focus {
    outline: none;
  }

  html {
    @apply text-base antialiased;
    /* Pantalla completa en móviles */
    height: 100%;
    overflow: hidden;
  }

  body {
    @apply font-sans leading-normal;
    background: var(--color-bg-primary);
    color: var(--color-text-primary);
    /* Pantalla completa en móviles */
    height: 100%;
    overflow: hidden;
    /* Prevenir zoom en iOS cuando se hace doble tap */
    touch-action: manipulation;
    /* Suavizar scroll en iOS */
    -webkit-overflow-scrolling: touch;
    /* Ocupar espacio de safe area en iPhone con notch */
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    /* Prevenir pull-to-refresh del navegador (implementaremos el nuestro) */
    overscroll-behavior-y: contain;
  }

  /* Scrollbar del body - auto-hide */
  body::-webkit-scrollbar {
    width: 8px;
  }

  body::-webkit-scrollbar-track {
    background: transparent;
  }

  body::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 10px;
    transition: background 0.3s ease;
  }

  body:hover::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.3);
  }

  body::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.5);
  }

  /* Ocultar las flechas de scroll */
  body::-webkit-scrollbar-button {
    display: none;
  }

  .dark body:hover::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.2);
  }

  .dark body::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.4);
  }

  /* Firefox - auto-hide scrollbar */
  body {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    transition: scrollbar-color 0.3s ease;
  }

  body:hover {
    scrollbar-color: rgba(156, 163, 175, 0.3) transparent;
  }

  .dark body:hover {
    scrollbar-color: rgba(156, 163, 175, 0.2) transparent;
  }

  #root {
    min-height: 100vh;
    /* Ocupar espacio de safe area */
    min-height: -webkit-fill-available;
  }

  /* Prevenir bounce/rubber-band scroll en iOS */
  body.prevent-bounce {
    position: fixed;
    overflow: hidden;
    width: 100%;
  }

  :root {
    /* ===== SISTEMA DE DISEÑO COMPACTO - MODO CLARO ===== */

    /* === FONDOS (4 niveles) === */
    --color-bg-primary: #ffffff;        /* Blanco - Fondo principal */
    --color-bg-secondary: #f9fafb;      /* gray-50 - Cards, modals */
    --color-bg-tertiary: #f3f4f6;       /* gray-100 - Hovers, inputs */
    --color-bg-hover: #e5e7eb;          /* gray-200 - Estados activos */

    /* === TEXTOS (3 niveles) === */
    --color-text-primary: #18181b;      /* zinc-900 - Texto principal */
    --color-text-secondary: #71717a;    /* zinc-500 - Texto secundario */
    --color-text-muted: #a1a1aa;        /* zinc-400 - Disabled, placeholders */

    /* === BORDES (2 niveles) === */
    --color-border: #e5e7eb;            /* gray-200 - Borde por defecto */
    --color-border-focus: #d1d5db;      /* gray-300 - Hover/focus/active */

    /* === COLORES SEMÁNTICOS (apagados y sobrios) === */
    --color-success: #4a9f7c;           /* Verde apagado */
    --color-success-light: #60b591;     /* Verde claro */
    --color-success-dark: #3d8566;      /* Verde oscuro */
    --color-success-bg: #e6f4ed;        /* Verde muy claro */
    --color-success-border: #9cd4ba;    /* Verde borde */

    --color-error: #c85a54;             /* Rojo terracota */
    --color-error-light: #d47570;       /* Rojo claro */
    --color-error-dark: #a84842;        /* Rojo oscuro */
    --color-error-bg: #f5e6e5;          /* Rojo muy claro */
    --color-error-border: #e3a8a4;      /* Rojo borde */

    --color-warning: #d4a574;           /* Mostaza */
    --color-warning-light: #ddb88a;     /* Mostaza claro */
    --color-warning-dark: #b88e5e;      /* Mostaza oscuro */
    --color-warning-bg: #f7f0e6;        /* Mostaza muy claro */
    --color-warning-border: #e8d0b0;    /* Mostaza borde */

    --color-info: #5b8fa3;              /* Azul grisáceo */
    --color-info-light: #75a5b8;        /* Azul claro */
    --color-info-dark: #4a7689;         /* Azul oscuro */
    --color-info-bg: #e6f0f4;           /* Azul muy claro */
    --color-info-border: #a4c7d4;       /* Azul borde */

    /* === ACENTO (gris azulado neutral) === */
    --color-accent: #5b6b8f;            /* Gris azulado */
    --color-accent-light: #7585a3;      /* Gris azulado claro */
    --color-accent-dark: #4a5778;       /* Gris azulado oscuro */
    --color-primary: #5b6b8f;           /* Alias para compatibilidad */

    /* === SOMBRAS (4 niveles) === */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
    --shadow-focus: 0 0 0 3px rgba(91, 107, 143, 0.12);

    /* === BORDER RADIUS === */
    --border-radius-sm: 0.375rem;       /* 6px */
    --border-radius-md: 0.5rem;         /* 8px */
    --border-radius-lg: 0.75rem;        /* 12px */
    --border-radius-xl: 1rem;           /* 16px */
    --border-radius-2xl: 1.5rem;        /* 24px */
    --border-radius-full: 9999px;       /* Completamente redondo */

    /* === SPACING === */
    --spacing-xs: 0.25rem;              /* 4px */
    --spacing-sm: 0.5rem;               /* 8px */
    --spacing-md: 1rem;                 /* 16px */
    --spacing-lg: 1.5rem;               /* 24px */
    --spacing-xl: 2rem;                 /* 32px */
    --spacing-2xl: 3rem;                /* 48px */
    --spacing-3xl: 4rem;                /* 64px */

    /* === TRANSICIONES === */
    --transition-fast: 150ms ease;
    --transition-base: 200ms ease;
    --transition-slow: 300ms ease;
    --transition-cubic: 200ms cubic-bezier(0.4, 0, 0.2, 1);

    /* === TIPOGRAFÍA === */
    --font-size-xs: 0.75rem;            /* 12px */
    --font-size-sm: 0.875rem;           /* 14px */
    --font-size-base: 1rem;             /* 16px */
    --font-size-lg: 1.125rem;           /* 18px */
    --font-size-xl: 1.25rem;            /* 20px */
    --font-size-2xl: 1.5rem;            /* 24px */
    --font-size-3xl: 1.875rem;          /* 30px */
    --font-size-4xl: 2.25rem;           /* 36px */

    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;

    --line-height-tight: 1.25;
    --line-height-normal: 1.5;
    --line-height-relaxed: 1.75;

    /* === Z-INDEX === */
    --z-dropdown: 1000;
    --z-sticky: 1020;
    --z-fixed: 1030;
    --z-modal-backdrop: 10000;  /* Por encima de TODO (TopBar: 9999) */
    --z-modal: 10001;           /* Modal content por encima del backdrop */
    --z-popover: 1060;
    --z-tooltip: 1070;

    /* === OPACIDAD === */
    --opacity-disabled: 0.5;
    --opacity-hover: 0.8;
    --opacity-overlay: 0.75;
  }

  /* Dark mode - VERSIÓN COMPACTADA */
  .dark {
    /* === FONDOS (4 niveles) === */
    --color-bg-primary: #111827;        /* gray-900 - Fondo principal */
    --color-bg-secondary: #1f2937;      /* gray-800 - Cards, modals */
    --color-bg-tertiary: #374151;       /* gray-700 - Hovers, inputs */
    --color-bg-hover: #4b5563;          /* gray-600 - Estados activos */

    /* === TEXTOS (3 niveles) === */
    --color-text-primary: #f4f4f5;      /* zinc-100 - Texto principal */
    --color-text-secondary: #a1a1aa;    /* zinc-400 - Texto secundario */
    --color-text-muted: #71717a;        /* zinc-500 - Disabled, placeholders */

    /* === BORDES (2 niveles) === */
    --color-border: #374151;            /* gray-700 - Borde por defecto */
    --color-border-focus: #4b5563;      /* gray-600 - Hover/focus/active */

    /* === SEMÁNTICOS (apagados y sobrios) === */
    --color-success: #4a9f7c;           /* Verde apagado */
    --color-success-light: #60b591;     /* Verde claro */
    --color-success-dark: #3d8566;      /* Verde oscuro */
    --color-success-bg: rgba(74, 159, 124, 0.15);
    --color-success-border: #3d8566;    /* Verde oscuro para borde */

    --color-error: #c85a54;             /* Rojo terracota */
    --color-error-light: #d47570;       /* Rojo claro */
    --color-error-dark: #a84842;        /* Rojo oscuro */
    --color-error-bg: rgba(200, 90, 84, 0.15);
    --color-error-border: #a84842;      /* Rojo oscuro para borde */

    --color-warning: #d4a574;           /* Mostaza */
    --color-warning-light: #ddb88a;     /* Mostaza claro */
    --color-warning-dark: #b88e5e;      /* Mostaza oscuro */
    --color-warning-bg: rgba(212, 165, 116, 0.15);
    --color-warning-border: #b88e5e;    /* Mostaza oscuro para borde */

    --color-info: #5b8fa3;              /* Azul grisáceo */
    --color-info-light: #75a5b8;        /* Azul claro */
    --color-info-dark: #4a7689;         /* Azul oscuro */
    --color-info-bg: rgba(91, 143, 163, 0.15);
    --color-info-border: #4a7689;       /* Azul oscuro para borde */

    /* === ACENTO (azul gris suave) === */
    --color-accent: #7a8fa8;            /* Azul gris suave */
    --color-accent-light: #92a5be;      /* Azul gris claro */
    --color-accent-dark: #657a92;       /* Azul gris oscuro */
    --color-primary: #7a8fa8;           /* Alias para compatibilidad */

    /* === SOMBRAS (4 niveles) === */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.5);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.6);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.7);
    --shadow-focus: 0 0 0 3px rgba(122, 143, 168, 0.25);
  }

  /* Dusk theme - Tonos tierra cálidos y neutros (ex-Sunset) */
  .dusk {
    /* === FONDOS (tonos tierra neutros) === */
    --color-bg-primary: #f7f4f1;        /* Beige grisáceo */
    --color-bg-secondary: #ebe6e0;      /* Beige más oscuro */
    --color-bg-tertiary: #dfd9d1;       /* Gris beige */
    --color-bg-hover: #d3cdc5;          /* Gris medio */

    /* === TEXTOS (marrones suaves) === */
    --color-text-primary: #2a2420;      /* Marrón muy oscuro */
    --color-text-secondary: #6a615a;    /* Gris marrón */
    --color-text-muted: #8f8580;        /* Gris claro */

    /* === BORDES (tierra sutiles) === */
    --color-border: #dfd9d1;            /* Gris beige */
    --color-border-focus: #d3cdc5;      /* Gris medio */

    /* === ACENTO (marrón cálido) === */
    --color-accent: #a67c52;            /* Marrón cálido */
    --color-accent-light: #b88d68;      /* Marrón claro */
    --color-accent-dark: #8f6941;       /* Marrón oscuro */
    --color-primary: #a67c52;           /* Alias para compatibilidad */

    /* === SOMBRAS === */
    --shadow-focus: 0 0 0 3px rgba(166, 124, 82, 0.15);

    /* === SEMÁNTICOS (apagados y sobrios) === */
    --color-success: #4a9f7c;           /* Verde apagado */
    --color-success-light: #60b591;     /* Verde claro */
    --color-success-dark: #3d8566;      /* Verde oscuro */
    --color-success-bg: #e6f4ed;        /* Verde muy claro */
    --color-success-border: #9cd4ba;    /* Verde borde */

    --color-error: #c85a54;             /* Rojo terracota */
    --color-error-light: #d47570;       /* Rojo claro */
    --color-error-dark: #a84842;        /* Rojo oscuro */
    --color-error-bg: #f5e6e5;          /* Rojo muy claro */
    --color-error-border: #e3a8a4;      /* Rojo borde */

    --color-warning: #d4a574;           /* Mostaza */
    --color-warning-light: #ddb88a;     /* Mostaza claro */
    --color-warning-dark: #b88e5e;      /* Mostaza oscuro */
    --color-warning-bg: #f7f0e6;        /* Mostaza muy claro */
    --color-warning-border: #e8d0b0;    /* Mostaza borde */

    --color-info: #5b8fa3;              /* Azul grisáceo */
    --color-info-light: #75a5b8;        /* Azul claro */
    --color-info-dark: #4a7689;         /* Azul oscuro */
    --color-info-bg: #e6f0f4;           /* Azul muy claro */
    --color-info-border: #a4c7d4;       /* Azul borde */
  }

  /* Night theme - Azul gris oscuro suave (ex-Midnight) */
  .night {
    /* === FONDOS (azul gris oscuro) === */
    --color-bg-primary: #0f1419;        /* Azul noche muy oscuro */
    --color-bg-secondary: #1a2128;      /* Azul gris */
    --color-bg-tertiary: #242c35;       /* Azul medio */
    --color-bg-hover: #2e3842;          /* Azul claro oscuro */

    /* === TEXTOS (gris claro) === */
    --color-text-primary: #e3e8ee;      /* Gris muy claro */
    --color-text-secondary: #8b93a1;    /* Gris medio */
    --color-text-muted: #6b7280;        /* Gris */

    /* === BORDES (azul gris sutiles) === */
    --color-border: #242c35;            /* Azul medio */
    --color-border-focus: #2e3842;      /* Azul claro oscuro */

    /* === ACENTO (azul grisáceo) === */
    --color-accent: #7a95b8;            /* Azul grisáceo */
    --color-accent-light: #92a9c9;      /* Azul claro */
    --color-accent-dark: #6481a3;       /* Azul oscuro */
    --color-primary: #7a95b8;           /* Alias para compatibilidad */

    /* === SEMÁNTICOS (apagados y sobrios) === */
    --color-success: #4a9f7c;           /* Verde apagado */
    --color-success-light: #60b591;     /* Verde claro */
    --color-success-dark: #3d8566;      /* Verde oscuro */
    --color-success-bg: rgba(74, 159, 124, 0.15);
    --color-success-border: #3d8566;    /* Verde oscuro para borde */

    --color-error: #c85a54;             /* Rojo terracota */
    --color-error-light: #d47570;       /* Rojo claro */
    --color-error-dark: #a84842;        /* Rojo oscuro */
    --color-error-bg: rgba(200, 90, 84, 0.15);
    --color-error-border: #a84842;      /* Rojo oscuro para borde */

    --color-warning: #d4a574;           /* Mostaza */
    --color-warning-light: #ddb88a;     /* Mostaza claro */
    --color-warning-dark: #b88e5e;      /* Mostaza oscuro */
    --color-warning-bg: rgba(212, 165, 116, 0.15);
    --color-warning-border: #b88e5e;    /* Mostaza oscuro para borde */

    --color-info: #5b8fa3;              /* Azul grisáceo */
    --color-info-light: #75a5b8;        /* Azul claro */
    --color-info-dark: #4a7689;         /* Azul oscuro */
    --color-info-bg: rgba(91, 143, 163, 0.15);
    --color-info-border: #4a7689;       /* Azul oscuro para borde */

    /* === SOMBRAS (más sutiles que antes) === */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.5);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.6);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.7);
    --shadow-focus: 0 0 0 3px rgba(122, 149, 184, 0.25);
  }
}

/* ============================================
   COMPONENTES REUTILIZABLES - @apply Tailwind
   ============================================ */

/* @layer components { */
  /* Botones Base */
  .btn {
    @apply inline-flex items-center justify-center gap-2;
    @apply px-5 py-2.5 min-h-[42px];
    @apply text-base font-medium leading-tight rounded-md;
    @apply border border-transparent cursor-pointer;
    @apply transition-none outline-none no-underline whitespace-nowrap;
    @apply w-auto flex-shrink-0;
  }

  .btn:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  /* Variantes de Botones */
  .btn-primary {
    @apply bg-primary text-white;
  }

  .btn-primary:hover:not(:disabled) {
    @apply bg-primary-light;
  }

  .btn-secondary {
    @apply bg-secondary text-white;
  }

  .btn-secondary:hover:not(:disabled) {
    @apply bg-secondary-dark;
  }

  .btn-accent {
    @apply bg-accent text-white;
  }

  .btn-accent:hover:not(:disabled) {
    @apply bg-accent-dark;
  }

  .btn-danger {
    @apply bg-error text-white;
  }

  .btn-danger:hover:not(:disabled) {
    @apply bg-red-600;
  }

  /* Icon Button - Para el Content Reader */
  .icon-btn {
    @apply p-2 bg-primary-100 dark:bg-primary-800 text-primary-700 dark:text-primary-300;
    @apply rounded-lg hover:bg-primary-200 dark:hover:bg-primary-700 transition-all;
    @apply disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .btn-outline {
    @apply bg-transparent text-primary;
    border: 1px solid var(--color-border);
  }

  .btn-outline:hover:not(:disabled) {
    @apply bg-primary text-white;
  }

  .btn-ghost {
    @apply bg-transparent;
    color: var(--color-text-primary);
  }

  .btn-ghost:hover:not(:disabled) {
    background: var(--color-bg-tertiary);
  }

  /* Tamaños de Botones */
  .btn-xs {
    @apply px-2 py-1 text-xs;
  }

  .btn-sm {
    @apply px-3.5 py-1.5 text-sm;
  }

  .btn-lg {
    @apply px-7 py-3.5 text-lg;
  }

  /* Botones Especiales */
  .btn-close {
    @apply bg-transparent border-none;
    @apply cursor-pointer p-0 flex items-center justify-center leading-none;
    @apply w-8 h-8 text-3xl transition-colors;
    color: var(--color-text-secondary);
  }

  .btn-close:hover {
    color: var(--color-text-primary);
  }

  .btn-remove {
    @apply bg-transparent border-none;
    @apply cursor-pointer p-0 flex items-center justify-center leading-none;
    @apply w-5 h-5 text-xl transition-colors;
    color: var(--color-error);
  }

  .btn-remove:hover {
    color: var(--color-error-dark);
  }

  .btn-cancel-instance {
    @apply px-2 py-1;
    @apply border-none rounded text-xs font-semibold cursor-pointer;
    @apply transition-all;
    background: var(--color-error-bg);
    color: var(--color-error);
  }

  .btn-cancel-instance:hover {
    background: var(--color-error-bg);
    opacity: 0.8;
  }


  .stat-value {
    @apply text-3xl font-extrabold;
    @apply leading-tight mb-1;
    color: var(--color-text-primary);
  }

  .stat-label {
    @apply text-sm font-semibold;
    color: var(--color-text-secondary);
  }

  /* Inputs - Minimalista sin bordes */
  .input {
    @apply w-full px-3.5 py-2.5 text-base leading-normal;
    @apply rounded-md;
    @apply transition-all duration-200 outline-none;
    color: var(--color-text-primary);
    background: var(--color-bg-tertiary);
    border: none;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .input:focus {
    background: var(--color-bg-secondary);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06),
                var(--shadow-focus);
  }

  .input:disabled {
    background: var(--color-bg-tertiary);
    cursor: not-allowed;
    opacity: 0.6;
  }

  .input-error {
    @apply border-error;
  }

  /* Select / Dropdown - Minimalista sin bordes */
  .select {
    @apply w-full px-3.5 py-2.5 text-base leading-normal;
    @apply rounded-md;
    @apply transition-all duration-200 outline-none cursor-pointer;
    @apply appearance-none bg-no-repeat;
    color: var(--color-text-primary);
    background: var(--color-bg-tertiary);
    border: none;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.5rem center;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }

  .select:focus {
    background: var(--color-bg-secondary);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06),
                var(--shadow-focus);
  }

  .select:disabled {
    background: var(--color-bg-tertiary);
    cursor: not-allowed;
    opacity: 0.6;
  }

  .select option {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  /* Labels */
  .label {
    @apply block text-sm font-medium mb-1;
    color: var(--color-text-primary);
  }

  .label-required::after {
    @apply text-error;
    content: " *";
  }

  /* Badges */
  .badge {
    @apply inline-flex items-center px-3 py-1;
    @apply text-xs font-semibold rounded-full uppercase tracking-wide;
  }

  .badge-success {
    @apply bg-green-100 text-green-700;
  }

  .badge-warning {
    @apply bg-amber-100 text-amber-700;
  }

  .badge-error {
    @apply bg-red-100 text-red-700;
  }

  .badge-info {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
  }

  .badge-teacher {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
  }

  .badge-student {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
  }

  /* Content card badge styles */
  .content-card-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 600;
    border-radius: 8px;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .content-card-badge.whiteboard {
    background: rgba(139, 92, 246, 0.95);
    color: white;
  }

  .dark .content-card-badge.whiteboard {
    background: rgba(139, 92, 246, 0.9);
  }

  /* ============================================
     ESTÁNDARES DE SPACING (Fase 3 - Unificación UI)
     ============================================

     MÁRGENES ESTANDARIZADOS:
     - PageHeader: mb-6 (built-in, 24px)
     - Tabs Container: mb-6 (24px)
     - Content Sections: space-y-6 (24px entre secciones)
     - Cards dentro de grid: gap-4 o gap-6 (16-24px)

     PADDING ESTANDARIZADO:
     - Containers principales: w-full (sin padding extra)
     - UniversalCard: p-6 (built-in, 24px)
     - Modal body: p-6 (24px)
     - Tab content: sin padding extra (el contenido define su spacing)

     COMPONENTES QUE USAN ESTOS ESTÁNDARES:
     ✅ SettingsPanel (Fase 1)
     ✅ ContentManagerTabs (Fase 2)
     ✅ ClassSessionManager (Fase 2)
     ✅ SettingsModal
     ✅ ClassSessionModal

     USO CORRECTO:
     Estructura: div.w-full > PageHeader + div.mb-6 (BaseTabs) + div.space-y-6 (UniversalCards)
     PageHeader tiene mb-6 automático
     UniversalCard tiene p-6 automático
     ============================================ */

  /* ============================================
     DROPDOWNS - Sistema unificado
     ============================================ */

  /* Dropdown Container - Minimalista sin bordes */
  .dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    min-width: 280px;
    background: var(--color-bg-primary);
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07),
                0 10px 15px rgba(0, 0, 0, 0.10);
    overflow: hidden;
    z-index: var(--z-dropdown);
    animation: dropdownFadeIn var(--transition-fast);
  }

  @keyframes dropdownFadeIn {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive: Ajustar dropdown en móvil */
  @media (max-width: 640px) {
    .dropdown {
      position: fixed;
      top: 72px;
      right: 12px;
      left: 12px;
      bottom: auto;
      min-width: auto;
      max-width: calc(100vw - 24px);
    }

    /* Cuando hay banner, dropdown se mueve hacia abajo */
    .dashboard-layout.has-banner .dropdown {
      top: 110px; /* 64px TopBar + 8px gap + 38px Banner */
    }
  }

  /* Dropdown Options Container */
  .dropdown-options {
    padding: 8px;
  }

  /* Dropdown Option (Item) */
  .dropdown-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 1px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all var(--transition-base);
    text-align: left;
  }

  .dropdown-option:hover {
    background: var(--color-bg-tertiary);
  }

  .dropdown-option.selected {
    background: var(--color-bg-tertiary);
    font-weight: 600;
  }

  /* Dropdown Option Content */
  .dropdown-option-content {
    flex: 1;
    min-width: 0;
  }

  .dropdown-option-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: 2px;
  }

  .dropdown-option-description {
    font-size: 12px;
    color: var(--color-text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Dropdown Icon */
  .dropdown-icon {
    flex-shrink: 0;
    color: var(--color-text-secondary);
  }

  /* Dropdown Check (for selected items) */
  .dropdown-check {
    flex-shrink: 0;
    color: var(--color-success);
  }

  /* Alerts */
  .alert {
    @apply p-4 rounded-md border-l-4 mb-4;
  }

  .alert-success {
    @apply bg-green-100 border-success text-green-800;
  }

  .alert-warning {
    @apply bg-amber-100 border-warning text-amber-800;
  }

  .alert-error {
    @apply bg-red-100 border-error text-red-800;
  }

  .alert-info {
    @apply border-info;
    background: var(--color-info-bg);
    color: var(--color-text-primary);
  }

  /* Containers */
  .container {
    @apply w-full max-w-screen-xl mx-auto px-4;
  }

  .container-sm {
    @apply max-w-screen-sm;
  }

  .container-md {
    @apply max-w-screen-md;
  }

  .container-lg {
    @apply max-w-screen-lg;
  }

  /* Dividers */
  .divider {
    @apply h-px my-6;
    background: var(--color-border);
  }

  /* Loading Spinner */
  .spinner {
    @apply border-4 border-t-primary;
    @apply rounded-full w-8 h-8 animate-spin;
    border-color: var(--color-border);
    border-top-color: var(--color-accent);
  }

  /* ============================================
     HEADERS Y TÍTULOS UNIFICADOS
     ============================================ */

  /* Panel Header - Header principal de cada panel/manager */
  .panel-header {
    @apply flex justify-between items-center mb-6;
  }

  .panel-title {
    @apply text-2xl font-bold m-0;
    color: var(--color-text-primary);
  }

  /* Section Header - Headers de secciones dentro de paneles */
  .section-header {
    @apply mb-6;
  }

  .section-title {
    @apply text-xl font-semibold mb-2;
    color: var(--color-text-primary);
  }

  .section-subtitle {
    @apply text-sm;
    color: var(--color-text-secondary);
  }

  /* Modal específicos */
  .modal-overlay {
    @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4;
    z-index: 1000;
  }

  .modal-box {
    @apply rounded-lg max-w-2xl w-full flex flex-col;
    background: var(--color-bg-secondary);
    height: 700px; /* Altura fija para que no salte al cambiar pestañas */
    max-height: 90vh; /* Respeta el viewport en pantallas pequeñas */
  }

  @media (min-width: 641px) {
    .modal-box {
      min-width: 600px; /* Ancho mínimo solo en desktop/tablet */
    }
  }

  @media (max-width: 640px) {
    .modal-overlay {
      padding: 0; /* Sin padding en móviles - pantalla completa */
      /* Respetar safe area en iPad/iOS */
      padding-bottom: env(safe-area-inset-bottom);
    }

    .modal-box {
      min-width: auto;
      margin: 0;
      border-radius: 0; /* Sin bordes redondeados en móviles */
      height: 100vh; /* Altura completa en móviles */
      max-height: calc(100vh - env(safe-area-inset-bottom)); /* Restar safe area inferior */
      width: 100vw; /* Ancho completo */
      max-width: 100vw;
    }
  }

  .modal-header {
    @apply flex justify-between items-start px-6 pt-6 pb-4 border-b;
    @apply flex-shrink-0;
    border-color: var(--color-border);
  }

  .modal-title {
    @apply text-2xl font-bold m-0;
    color: var(--color-text-primary);
  }

  .modal-content {
    @apply overflow-y-auto px-6 py-4 custom-scrollbar;
    flex: 1; /* Toma todo el espacio disponible */
    min-height: 0; /* Permite que el scroll funcione correctamente */
  }

  .modal-body {
    @apply overflow-y-auto px-6 py-4 custom-scrollbar;
    flex: 1; /* Toma todo el espacio disponible */
    min-height: 0; /* Permite que el scroll funcione correctamente */
  }

  .modal-footer {
    @apply flex gap-3 px-6 pb-6 pt-4 border-t;
    @apply flex-shrink-0;
    border-color: var(--color-border);
  }

  .modal-footer .btn {
    @apply flex-1;
    height: 42px; /* Altura fija para todos los botones */
  }

  /* Responsive: Stack buttons en móvil */
  @media (max-width: 640px) {
    .modal-footer {
      @apply flex-col gap-2;
    }

    .modal-footer .btn {
      @apply w-full;
      flex: none; /* Anula flex-1 en móvil */
    }
  }

  /* Form Groups */
  .form-group {
    margin-bottom: 24px;
  }

  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: 8px;
    line-height: 1.5;
  }

  /* Tabs Container - Con scroll horizontal */
  .modal-tabs-container {
    @apply px-6 flex-shrink-0 overflow-x-auto;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent; /* Invisible por defecto */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling en móviles */
    transition: scrollbar-color 0.3s ease;
  }

  .modal-tabs-container:hover {
    scrollbar-color: rgba(156, 163, 175, 0.3) transparent; /* Visible al hover */
  }

  .dark .modal-tabs-container:hover {
    scrollbar-color: rgba(156, 163, 175, 0.2) transparent;
  }

  .modal-tabs-container::-webkit-scrollbar {
    height: 8px; /* Consistente con scrollbar vertical */
    width: 8px;  /* Por si hay scroll vertical también */
  }

  .modal-tabs-container::-webkit-scrollbar-track {
    background: transparent;
  }

  /* Invisible por defecto */
  .modal-tabs-container::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 10px;
    transition: background 0.3s ease;
  }

  /* Visible al hacer hover sobre el área scrollable */
  .modal-tabs-container:hover::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.3);
  }

  .modal-tabs-container::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.5);
  }

  .dark .modal-tabs-container:hover::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.2);
  }

  .dark .modal-tabs-container::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.4);
  }

  .modal-tabs {
    @apply flex gap-2;
    min-width: min-content;
    padding-bottom: 4px; /* Espacio para el scrollbar */
  }

  /* Tabs */
  .tab {
    @apply px-4 py-2 font-semibold transition-colors whitespace-nowrap;
    color: var(--color-text-secondary);
    min-width: 100px; /* Ancho mínimo por pestaña */
  }

  .tab:hover {
    color: var(--color-text-primary);
  }

  .tab-active {
    @apply px-4 py-2 font-semibold whitespace-nowrap;
    border-bottom: 2px solid var(--color-accent);
    min-width: 100px;
    color: var(--color-text-primary);
  }

  /* Tabs Responsive para Móvil */
  @media (max-width: 768px) {
    .modal-tabs-container {
      padding: 0 1rem; /* Menos padding lateral */
    }

    .modal-tabs {
      gap: 0.5rem; /* Menos gap entre tabs */
    }

    .tab,
    .tab-active {
      min-width: auto; /* ← CRÍTICO: Eliminar 100px forzado */
      padding: 0.75rem 1rem; /* px-4 py-3 → px-4 py-2.5 */
      font-size: 0.875rem; /* text-sm */
    }

    /* Tab content más compacto */
    .tab-content {
      padding: 1rem; /* Menos padding en móvil */
    }
  }

  /* Inline icon helper */
  .inline-icon {
    @apply inline-block align-text-bottom;
  }


  /* ============================================
     TABLAS - Estilos Globales
     ============================================ */

  .table-container {
    overflow-x: auto;
    border-radius: 12px;
    border: 1px solid var(--color-border);
    background: var(--color-bg-secondary);
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  /* Header */
  thead {
    background: var(--color-bg-tertiary);
    border-bottom: 1px solid var(--color-border);
  }

  th {
    padding: 12px 16px;
    text-align: left;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--color-text-secondary);
  }

  /* Filas */
  tbody tr {
    border-bottom: 1px solid var(--color-border);
    transition: background 0.15s;
  }

  tbody tr:hover {
    background: var(--color-bg-tertiary);
  }

  /* Celdas */
  td {
    padding: 12px 16px;
    color: var(--color-text-primary);
    font-size: 14px;
  }

  /* Toggle de Vista */
  .view-toggle {
    @apply flex gap-2 rounded-lg p-1;
    background: var(--color-bg-tertiary);
  }

  .view-toggle-btn {
    @apply px-4 py-2 rounded-md transition-colors;
    color: var(--color-text-secondary);
  }

  .view-toggle-btn.active {
    @apply shadow-sm font-semibold;
    background: var(--color-bg-primary);
    color: var(--color-text-primary);
  }

  .view-toggle-btn:hover:not(.active) {
    color: var(--color-text-primary);
  }

  /* Mobile: divider oculto, botones más pequeños */
  @media (max-width: 768px) {
    .searchbar-divider {
      display: none;
    }

    .view-toggle-btn {
      @apply px-2 py-1;
    }
  }

/* ============================================
   UTILIDADES PERSONALIZADAS
   ============================================ */

/* @layer utilities { */
  .text-gradient {
    @apply bg-gradient-to-r from-primary to-secondary;
    @apply bg-clip-text text-transparent;
  }

  .shadow-elevated {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .backdrop-blur {
    backdrop-filter: blur(10px);
    background: rgba(var(--color-bg-primary), 0.8);
  }

  /* Scrollbar personalizado - minimal (vertical y horizontal) */
  /* Solo aparece al hacer hover o durante el scroll */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;   /* Ancho de scrollbar vertical */
    height: 8px;  /* Alto de scrollbar horizontal */
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  /* Invisible por defecto */
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 10px;
    transition: background 0.3s ease;
  }

  /* Visible al hacer hover sobre el área scrollable */
  .custom-scrollbar:hover::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.3);
  }

  /* Más oscuro al hacer hover directo sobre el thumb */
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.5);
  }

  /* Dark mode */
  .dark .custom-scrollbar:hover::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.2);
  }

  .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.4);
  }

  /* Firefox - auto-hide scrollbar */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent; /* Invisible por defecto */
    transition: scrollbar-color 0.3s ease;
  }

  .custom-scrollbar:hover {
    scrollbar-color: rgba(156, 163, 175, 0.3) transparent;
  }

  .dark .custom-scrollbar:hover {
    scrollbar-color: rgba(156, 163, 175, 0.2) transparent;
  }

  /* Botón cerrar modal - diseño redondo y grande */
  .modal-close-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    border: none;
    cursor: pointer;
    transition: all var(--transition-base);
    flex-shrink: 0;
  }

  .modal-close-btn:hover {
    background: var(--color-bg-hover);
    color: var(--color-text-primary);
    transform: scale(1.05);
  }

/* ============================================
   ESTILOS GLOBALES PARA INPUTS Y FORMS
   ============================================ */

/* Inputs, textareas y selects globales */
input:not([type="checkbox"]):not([type="radio"]),
textarea,
select {
  background: var(--color-bg-tertiary) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

input:not([type="checkbox"]):not([type="radio"]):focus,
textarea:focus,
select:focus {
  background: var(--color-bg-primary) !important;
  border-color: var(--color-border-focus) !important;
}

input::placeholder,
textarea::placeholder {
  color: var(--color-text-muted) !important;
}

/* Fix para autocomplete del navegador */
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0 30px var(--color-bg-tertiary) inset !important;
  -webkit-text-fill-color: var(--color-text-primary) !important;
}

/* ============================================
   SOPORTE APPLE PENCIL Y STYLUS
   ============================================ */

/* Canvas para dibujo con Apple Pencil */
canvas[style*="touchAction"] {
  /* Prevenir scroll y zoom durante el dibujo */
  touch-action: none;
  /* Prevenir selección de texto */
  -webkit-user-select: none;
  user-select: none;
  /* Evitar efectos de tap highlight */
  -webkit-tap-highlight-color: transparent;
  /* Suavizar renderizado */
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}

/* Mejorar rendimiento del canvas */
canvas {
  /* Hardware acceleration */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: contents;
}

/* ============================================
   QUICK ACCESS CARDS - Vista Grid y Lista
   ============================================ */

/* Vista de grilla para QuickAccessCards */
.quick-access-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

/* Vista de lista para QuickAccessCards */
.quick-access-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 24px;
}

/* Adaptación de QuickAccessCard para vista lista */
.quick-access-list > div {
  flex-direction: row !important;
  height: auto !important;
}

.quick-access-list > div > div:first-child {
  width: 120px !important;
  height: 100px !important;
  flex-shrink: 0;
}

.quick-access-list > div > div:last-child {
  flex-direction: row !important;
  align-items: center;
  gap: 20px;
}

.quick-access-list > div h3 {
  margin-bottom: 0 !important;
  flex: 1;
}

.quick-access-list > div p {
  display: none;
}

.quick-access-list > div > div:last-child > div:nth-child(2) {
  margin: 0 !important;
  padding: 0 !important;
  border: none !important;
}

/* Responsive para móviles */
@media (max-width: 768px) {
  .quick-access-grid {
    grid-template-columns: 1fr;
  }

  .quick-access-list > div > div:first-child {
    width: 80px !important;
    height: 80px !important;
  }

  .quick-access-list > div h3 {
    font-size: 16px;
  }
}

/* ============================================
   ANIMACIONES PERSONALIZADAS
   ============================================ */

/* Shimmer effect para audio player */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.animate-shimmer {
  animation: shimmer 2s linear infinite;
}

/* ============================================
   CUSTOM RANGE SLIDER (Font Size)
   ============================================ */

/* Slider track */
input[type="range"].slider-purple {
  -webkit-appearance: none;
  appearance: none;
}

input[type="range"].slider-purple::-webkit-slider-track {
  height: 8px;
  border-radius: 4px;
  background: linear-gradient(to right, #9333ea, #c084fc);
}

input[type="range"].slider-purple::-moz-range-track {
  height: 8px;
  border-radius: 4px;
  background: linear-gradient(to right, #9333ea, #c084fc);
}

/* Slider thumb */
input[type="range"].slider-purple::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #9333ea;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
}

input[type="range"].slider-purple::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #9333ea;
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
}

/* Hover effects */
input[type="range"].slider-purple::-webkit-slider-thumb:hover {
  background: #a855f7;
  transform: scale(1.1);
}

input[type="range"].slider-purple::-moz-range-thumb:hover {
  background: #a855f7;
  transform: scale(1.1);
}

/* Active/pressed state */
input[type="range"].slider-purple::-webkit-slider-thumb:active {
  background: #7e22ce;
  transform: scale(0.95);
}

input[type="range"].slider-purple::-moz-range-thumb:active {
  background: #7e22ce;
  transform: scale(0.95);
}

/* ============================================
   SCROLLBAR VISIBLE PARA DASHBOARD LAYOUT
   ============================================ */

/* Scrollbar del contenedor principal del dashboard - solo cuando es necesario */
.dashboard-layout main,
.universal-dashboard__content {
  /* Scrollbar automático (solo aparece cuando hay contenido que scrollear) */
  overflow-y: auto !important;
  overflow-x: hidden;
  /* Reservar espacio para scrollbar y prevenir layout shift */
  scrollbar-gutter: stable;
  /* Prevenir scroll bounce/overscroll */
  overscroll-behavior-y: contain;
}

/* Webkit (Chrome, Safari, Edge) */
.dashboard-layout main::-webkit-scrollbar,
.universal-dashboard__content::-webkit-scrollbar {
  width: 12px;
}

.dashboard-layout main::-webkit-scrollbar-track,
.universal-dashboard__content::-webkit-scrollbar-track {
  background: #f1f5f9; /* gray-100 */
  border-radius: 0;
}

.dashboard-layout main::-webkit-scrollbar-thumb,
.universal-dashboard__content::-webkit-scrollbar-thumb {
  background: #cbd5e1; /* gray-300 */
  border-radius: 6px;
  border: 2px solid #f1f5f9; /* Padding visual */
}

.dashboard-layout main::-webkit-scrollbar-thumb:hover,
.universal-dashboard__content::-webkit-scrollbar-thumb:hover {
  background: #94a3b8; /* gray-400 */
}

.dashboard-layout main::-webkit-scrollbar-button,
.universal-dashboard__content::-webkit-scrollbar-button {
  display: none;
}

/* Dark mode */
.dark .dashboard-layout main::-webkit-scrollbar-track,
.dark .universal-dashboard__content::-webkit-scrollbar-track {
  background: #1f2937; /* gray-800 */
}

.dark .dashboard-layout main::-webkit-scrollbar-thumb,
.dark .universal-dashboard__content::-webkit-scrollbar-thumb {
  background: #6b7280; /* gray-500 */
  border-color: #1f2937;
}

.dark .dashboard-layout main::-webkit-scrollbar-thumb:hover,
.dark .universal-dashboard__content::-webkit-scrollbar-thumb:hover {
  background: #9ca3af; /* gray-400 */
}

/* Firefox */
.dashboard-layout main,
.universal-dashboard__content {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e1 #f1f5f9; /* thumb track */
}

.dark .dashboard-layout main,
.dark .universal-dashboard__content {
  scrollbar-color: #6b7280 #1f2937;
}

/* ============================================
   FIN DEL ARCHIVO - TODO CENTRALIZADO EN TAILWIND
   ============================================ */

/* ============================================
   UNIVERSAL DASHBOARD COMPONENTS
   ============================================ */

/* ===== UNIVERSAL TOP BAR (Minimalista sin bordes) ===== */
.universal-topbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: var(--color-bg-primary);
  /* Sin borde, solo sombra sutil */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 1.5rem;
  z-index: 9999;
  transition: all 0.3s ease;
}

.universal-dashboard--viewing-as .universal-topbar {
  top: 44px;
}

.universal-topbar__left {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 2;
  min-width: 0; /* Para permitir text-overflow */
}

.universal-topbar__menu-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  flex-shrink: 0;
  border: none;
  background: transparent;
  border-radius: 0.5rem;
  cursor: pointer;
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
}

.universal-topbar__menu-btn:hover {
  background: var(--color-bg-tertiary);
}

/* App title - 西文教室 */
.universal-topbar__app-title {
  flex-shrink: 0;
}

.universal-topbar__app-title h1 {
  font-size: 1.25rem;
  font-weight: 700;
  margin: 0;
  color: var(--color-text-primary);
  white-space: nowrap; /* CRÍTICO: Prevenir quiebre en 2 líneas */
}

/* Back button */
.universal-topbar__back-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  flex-shrink: 0;
  border: none;
  background: var(--color-bg-tertiary);
  border-radius: 0.5rem;
  cursor: pointer;
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
  margin-left: 0.5rem;
}

.universal-topbar__back-btn:hover {
  background: var(--color-primary);
  color: white;
}

/* Page title (título del diario/página) */
.universal-topbar__page-title {
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
  min-width: 0;
  flex: 1;
}

.universal-topbar__page-title-text {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.universal-topbar__page-subtitle {
  font-size: 0.7rem;
  color: var(--color-text-muted);
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.universal-topbar__center {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  flex: 1.5;
  padding-right: 1rem;
}

.universal-topbar__actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.universal-topbar__action-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.universal-topbar__action-btn svg {
  flex-shrink: 0;
}

.universal-topbar__right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
  justify-content: flex-end;
}

.universal-topbar__icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border: none;
  background: transparent;
  border-radius: 0.5rem;
  cursor: pointer;
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
  position: relative;
}

.universal-topbar__icon-btn:hover {
  background: var(--color-bg-tertiary);
}

.universal-topbar__notifications {
  position: relative;
}

.universal-topbar__badge {
  position: absolute;
  top: 6px;
  right: 6px;
  background: var(--color-error);
  color: white;
  font-size: 0.625rem;
  font-weight: 600;
  padding: 0.125rem 0.375rem;
  border-radius: 999px;
  min-width: 18px;
  text-align: center;
}

.universal-topbar__user-menu {
  position: relative;
}

.universal-topbar__user-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0.75rem;
  border: none;
  background: transparent;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.universal-topbar__user-btn:hover {
  background: var(--color-bg-tertiary);
}

.universal-topbar__avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--color-accent);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  overflow: hidden;
}

.universal-topbar__avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.universal-topbar__username {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  max-width: 150px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.universal-topbar__dropdown {
  position: absolute;
  top: calc(100% + 0.5rem);
  right: 0;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: 0.5rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  overflow: hidden;
  z-index: 10001;
}

.universal-topbar__dropdown-item {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
  text-align: left;
}

.universal-topbar__dropdown-item:hover {
  background: var(--color-bg-tertiary);
}

.universal-topbar__dropdown-item--danger {
  color: var(--color-error);
}

.universal-topbar__dropdown-item--danger:hover {
  background: #fef2f2;
}

.dark .universal-topbar__dropdown-item--danger:hover {
  background: #7f1d1d;
}

.universal-topbar__dropdown-divider {
  height: 1px;
  background: var(--color-border);
  margin: 0.25rem 0;
}

/* ===== UNIVERSAL SIDE MENU (Minimalista sin bordes) ===== */
.universal-sidemenu {
  position: fixed;
  left: 0;
  top: 64px;
  bottom: 0;
  width: 260px;
  background: var(--color-bg-primary);
  /* Sin borde, solo sombra lateral sutil */
  box-shadow: 1px 0 3px rgba(0, 0, 0, 0.03);
  transform: translateX(-100%);
  transition: transform 0.3s ease, top 0.3s ease;
  z-index: 90;
  overflow-y: auto;
}

.universal-dashboard--viewing-as .universal-sidemenu {
  top: calc(64px + 44px);
}

.universal-sidemenu--open {
  transform: translateX(0);
}

.universal-sidemenu__nav {
  padding: 1rem 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.universal-sidemenu__item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border: none;
  background: transparent;
  border-radius: 0.5rem;
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
  text-align: left;
  width: 100%;
}

.universal-sidemenu__item:hover {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.universal-sidemenu__item--active {
  background: var(--color-accent);
  color: #ffffff;
}

.universal-sidemenu__item--active:hover {
  background: var(--color-accent);
  opacity: 0.9;
}

.universal-sidemenu__icon {
  flex-shrink: 0;
}

.universal-sidemenu__label {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.universal-sidemenu__divider {
  display: none;
  height: 1px;
  background: var(--color-border);
  margin: 0.5rem 0;
}

.universal-sidemenu::-webkit-scrollbar {
  width: 6px;
}

.universal-sidemenu::-webkit-scrollbar-track {
  background: transparent;
}

.universal-sidemenu::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

.universal-sidemenu::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-muted);
}

/* ===== SIDEMENU (Legacy Dashboard) ===== */
.sidemenu {
  position: fixed;
  left: 0;
  /* Safe area: calc(topbar + max(safe-area, 20px)) para móviles */
  /* En desktop (lg:) usamos 64px porque no hay barra de estado */
  top: calc(48px + max(env(safe-area-inset-top), 20px));
  bottom: 0;
  width: 260px;
  background: var(--color-bg-primary);
  border-right: 1px solid var(--color-border);
  transform: translateX(-100%);
  transition: transform 0.3s ease, top 0.3s ease;
  z-index: 90;
  overflow-y: auto;
}

/* Desktop: sin safe-area extra porque no hay barra de estado */
@media (min-width: 1024px) {
  .sidemenu {
    top: 64px;
  }
}

.sidemenu.open {
  transform: translateX(0);
}

.sidemenu-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 85;
  display: block;
}

.sidemenu-content {
  padding: 0;
}

.sidemenu-nav {
  padding: 1rem 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.sidemenu-section {
  margin-bottom: 0;
}

.sidemenu-section-items {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.sidemenu-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border: none;
  background: transparent;
  border-radius: 0.5rem;
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
  text-align: left;
  width: 100%;
}

.sidemenu-item:hover {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.sidemenu-item.active {
  background: var(--color-accent);
  color: #ffffff;
}

.sidemenu-item.active:hover {
  background: var(--color-accent);
  opacity: 0.9;
}

.sidemenu-item-icon {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidemenu-item-label {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.sidemenu::-webkit-scrollbar {
  width: 6px;
}

.sidemenu::-webkit-scrollbar-track {
  background: transparent;
}

.sidemenu::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

.sidemenu::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-muted);
}

/* Responsive para .sidemenu */
@media (min-width: 1024px) {
  /* En desktop, el sidemenu respeta la clase .open para poder ocultarse */
  /* No forzamos transform aquí para que .sidemenu.open del CSS base funcione */

  /* Solo ocultamos el overlay en desktop */
  .sidemenu-overlay {
    display: none;
  }
}

/* Tablets: safe-area con fallback + altura de topbar de tablet (56px) */
@media (min-width: 768px) and (max-width: 1023px) {
  .sidemenu {
    top: calc(56px + max(env(safe-area-inset-top), 20px));
    width: 100%;
    max-width: 300px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  }
}

/* Móvil pequeño: mantener estilos de layout */
@media (max-width: 767px) {
  .sidemenu {
    width: 100%;
    max-width: 300px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  }
}

/* ===== SIDEMENU TOGGLE (Mostrar/Ocultar Eliminar) ===== */
.sidemenu-divider {
  height: 1px;
  background: var(--color-border);
  margin: 0.75rem 0.75rem;
  opacity: 0.5;
}

.sidemenu-toggle-section {
  padding: 0.5rem 0.75rem 0.75rem;
}

.sidemenu-toggle-btn {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.625rem 0.875rem;
  border-radius: 0.5rem;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  background: transparent;
  border: 1px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
}

.sidemenu-toggle-btn:hover {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.sidemenu-toggle-btn.active {
  background: var(--color-bg-tertiary);
  border-color: var(--color-border);
  color: var(--color-text-primary);
}

.sidemenu-toggle-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.sidemenu-toggle-label {
  flex: 1;
  text-align: left;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.sidemenu-toggle-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 0.375rem;
  transition: all 0.2s ease;
  background: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.sidemenu-toggle-indicator.off {
  opacity: 0.5;
}

/* ===== UNIVERSAL DASHBOARD ===== */
.universal-dashboard {
  min-height: 100vh;
  background: var(--color-bg-primary);
}

.universal-dashboard__loading,
.universal-dashboard__error {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 2rem;
}

.universal-dashboard__error {
  color: var(--color-error);
  font-size: 1.125rem;
}

.universal-dashboard__overlay {
  position: fixed;
  top: 64px;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 85;
  display: none;
}

.universal-dashboard__content {
  margin-top: 64px;
  margin-left: 0;
  padding: 1.5rem;
  height: calc(100vh - 64px);
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  overscroll-behavior-y: contain;
  transition: margin-left 0.3s ease, margin-top 0.3s ease;
}

.universal-dashboard--viewing-as .universal-dashboard__content {
  margin-top: calc(64px + 44px);
  height: calc(100vh - 64px - 44px);
}

.universal-dashboard--viewing-as .universal-dashboard__overlay {
  top: calc(64px + 44px);
}

/* Estilos de .universal-dashboard__welcome eliminados - ahora usa Tailwind inline */

.universal-dashboard__features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.feature-card {
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: 0.75rem;
  padding: 1.5rem;
  transition: all 0.2s ease;
}

.feature-card:hover {
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.feature-card h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 0.5rem;
}

.feature-card p {
  color: var(--color-text-muted);
  font-size: 0.875rem;
  margin: 0;
}

.universal-dashboard__placeholder {
  max-width: 800px;
  margin: 0 auto;
  text-align: center;
  padding: 4rem 2rem;
}

.universal-dashboard__placeholder h2 {
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 1rem;
}

.universal-dashboard__placeholder p {
  color: var(--color-text-muted);
  font-size: 1.125rem;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .universal-topbar {
    height: 56px;
    padding: 0 1rem;
  }

  .universal-dashboard--viewing-as .universal-topbar {
    top: 38px;
  }

  .universal-topbar__app-title h1 {
    font-size: 0.95rem; /* Reducido para móviles */
  }

  .universal-topbar__left {
    gap: 0.5rem;
  }

  .universal-topbar__back-btn {
    width: 32px;
    height: 32px;
    margin-left: 0;
  }

  .universal-topbar__page-title-text {
    font-size: 0.8rem;
  }

  .universal-topbar__page-subtitle,
  .universal-topbar__username {
    display: none;
  }

  .universal-topbar__action-btn span {
    display: none; /* Solo mostrar iconos en mobile */
  }

  .universal-topbar__actions {
    gap: 0.25rem;
  }

  .universal-topbar__center {
    flex: 1;
    padding-right: 0.5rem;
  }

  .universal-sidemenu {
    top: 56px;
    width: 100%;
    max-width: 300px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  }

  .universal-dashboard--viewing-as .universal-sidemenu {
    top: calc(56px + 38px);
  }

  .universal-dashboard__content {
    margin-top: 56px;
    height: calc(100vh - 56px);
    padding: 1rem;
  }

  .universal-dashboard__overlay {
    top: 56px;
    display: block;
  }

  .universal-dashboard--viewing-as .universal-dashboard__content {
    margin-top: calc(56px + 38px);
    height: calc(100vh - 56px - 38px);
  }

  .universal-dashboard--viewing-as .universal-dashboard__overlay {
    top: calc(56px + 38px);
  }

  .universal-dashboard__welcome h1 {
    font-size: 1.5rem;
  }

  .universal-dashboard__features {
    grid-template-columns: 1fr;
  }
}

/* Móviles muy pequeños (iPhone SE, etc) */
@media (max-width: 375px) {
  .universal-topbar {
    padding: 0 0.75rem; /* Menos padding en móviles pequeños */
  }

  .universal-topbar__title h1 {
    font-size: 0.85rem; /* Aún más pequeño para móviles tiny */
  }

  .universal-topbar__left {
    gap: 0.5rem; /* Reducir gap entre hamburger y logo */
  }
}

@media (min-width: 1024px) {
  /* En desktop, el menú se muestra por defecto pero puede cerrarse */
  .universal-sidemenu--open {
    transform: translateX(0);
  }

  .universal-dashboard__content--menu-open {
    margin-left: 260px;
  }

  .universal-dashboard__overlay {
    display: none !important;
  }
}
/**
 * Messaging System Styles
 */

/* ===== Messages Panel ===== */
.messages-panel {
  display: flex;
  height: 100%;
  min-height: 600px;
  background: var(--color-bg-primary);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* ===== Sidebar ===== */
.messages-sidebar {
  width: 360px;
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  background: var(--color-bg-secondary);
}

.messages-sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px;
  border-bottom: 1px solid var(--color-border);
}

.header-title {
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--color-text-primary);
}

.header-title h2 {
  margin: 0;
  font-size: 20px;
  font-weight: 700;
}

.unread-badge {
  background: #ef4444;
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
}

.btn-new-message {
  padding: 10px;
  background: var(--color-primary, #5b6b8f);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-new-message:hover {
  background: var(--color-primary-dark, #4a5a7a);
  transform: scale(1.05);
}

/* Search - Mismos estilos que .thread-search-bar */
.messages-search {
  padding: 12px 16px;
  background: var(--color-bg-secondary);
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Conversations List */
.conversations-list {
  flex: 1;
  overflow-y: auto;
}

.conversation-item {
  display: flex;
  gap: 12px;
  padding: 16px 20px;
  cursor: pointer;
  transition: background 0.15s;
  border-bottom: 1px solid var(--color-border);
}

.conversation-item:hover {
  background: var(--color-bg-tertiary);
}

.conversation-item.selected {
  background: var(--color-bg-tertiary);
  border-left: 4px solid var(--color-primary, #5b6b8f);
}

.conversation-item.unread {
  background: rgba(99, 102, 241, 0.05);
}

.conversation-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  border: 3px solid var(--color-bg-secondary);
  flex-shrink: 0;
}

.conversation-content {
  flex: 1;
  min-width: 0;
}

.conversation-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 4px;
}

.conversation-name {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: 15px;
}

.conversation-time {
  font-size: 12px;
  color: var(--color-text-secondary);
}

.conversation-preview {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}

.conversation-preview p {
  margin: 0;
  font-size: 14px;
  color: var(--color-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}

.conversation-item.unread .conversation-preview p {
  font-weight: 600;
  color: var(--color-text-primary);
}

.unread-count {
  background: var(--color-primary, #5b6b8f);
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  flex-shrink: 0;
}

/* ===== Main Thread Area ===== */
.messages-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--color-bg-primary);
}

.messages-empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  color: var(--color-text-secondary);
  padding: 40px;
}

.messages-empty-state svg {
  color: var(--color-text-tertiary);
}

.messages-empty-state h3 {
  margin: 0;
  color: var(--color-text-primary);
  font-size: 24px;
}

.messages-empty-state p {
  margin: 0;
  font-size: 14px;
}

/* ===== Message Thread ===== */
.message-thread {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Thread Header */
.thread-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px;
  border-bottom: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
}

.thread-user-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.thread-avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
}

.thread-user-details h3 {
  margin: 0;
  font-size: 16px;
  color: var(--color-text-primary);
}

.thread-user-email {
  font-size: 13px;
  color: var(--color-text-secondary);
}

.thread-actions {
  display: flex;
  gap: 8px;
  position: relative;
}

.thread-menu-btn,
.thread-close-btn {
  padding: 8px;
  background: var(--color-bg-tertiary);
  border: none;
  border-radius: 8px;
  color: var(--color-text-primary);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
}

.thread-menu-btn:hover,
.thread-close-btn:hover {
  background: var(--color-bg-primary);
  transform: scale(1.05);
}

.thread-menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 8px;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 10;
  min-width: 200px;
}

.thread-menu button {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 12px 16px;
  background: none;
  border: none;
  text-align: left;
  color: var(--color-text-primary);
  cursor: pointer;
  font-size: 14px;
  transition: background 0.15s;
}

.thread-menu button:hover {
  background: var(--color-bg-tertiary);
}

/* Messages List */
.messages-list {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  /* IMPORTANTE: Contener el scroll dentro de este elemento */
  position: relative;
  min-height: 0; /* Permite que flex: 1 funcione correctamente con overflow */
}

.messages-empty {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary);
  font-size: 14px;
}

/* Message Bubble */
.message-bubble-container {
  display: flex;
  gap: 10px;
  align-items: flex-end;
  animation: messageSlideIn 0.2s ease;
}

.message-bubble-container.own {
  flex-direction: row-reverse;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 700;
  flex-shrink: 0;
}

.message-bubble {
  max-width: 60%;
  min-width: 80px;
  padding: 8px 12px; /* Padding más generoso para mejor legibilidad */
  border-radius: 16px;
  position: relative;
  display: inline-block;
  width: auto;
}

.message-bubble-container.own .message-bubble {
  background: var(--color-primary, #5b6b8f);
  color: white;
  border-bottom-right-radius: 4px;
}

.message-bubble-container.other .message-bubble {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border-bottom-left-radius: 4px;
}

.message-sender {
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 4px; /* Espacio adecuado entre nombre y mensaje */
  opacity: 0.8;
}

.message-content {
  font-size: 14px;
  line-height: 1.4; /* Más legible y natural */
  word-wrap: break-word;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
  margin: 0;
  padding: 0;
}

.message-time {
  font-size: 11px; /* Restaurado al tamaño original */
  opacity: 0.7;
  margin-top: 0;
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Message Input */
.message-input-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 20px;
  border-top: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
}

.message-input {
  flex: 1;
  padding: 12px 16px;
  border: 2px solid var(--color-border);
  border-radius: 12px;
  font-size: 14px;
  color: var(--color-text-primary);
  background: var(--color-bg-primary);
  resize: vertical;
  min-height: 80px;
  max-height: 200px;
  font-family: inherit;
  line-height: 1.5;
}

.message-input:focus {
  outline: none;
  border-color: var(--color-primary, #5b6b8f);
}

.send-button {
  padding: 12px 16px;
  background: var(--color-primary, #5b6b8f);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.send-button:hover:not(:disabled) {
  background: var(--color-primary-dark, #4a5a7a);
  transform: translateY(-2px);
}

.send-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ===== New Message Modal ===== */
.new-message-modal {
  width: 600px;
  max-width: 90vw;
}

.selected-user {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px;
  background: var(--color-bg-tertiary);
  border-radius: 12px;
  margin-bottom: 20px;
}

.selected-user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.user-avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
}

.user-details {
  flex: 1;
}

.user-name {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: 15px;
}

.user-email {
  font-size: 13px;
  color: var(--color-text-secondary);
}

.role-badge {
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
}

.role-badge-admin {
  background: #fef3c7;
  color: #92400e;
}

.role-badge-teacher {
  background: #d1fae5;
  color: #065f46;
}

.role-badge-student {
  background: #dbeafe;
  color: #1e40af;
}

.role-badge-listener,
.role-badge-trial {
  background: #f3f4f6;
  color: #374151;
}

.remove-user-btn {
  padding: 8px;
  background: var(--color-bg-primary);
  border: none;
  border-radius: 6px;
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.2s;
}

.remove-user-btn:hover {
  background: #fee2e2;
  color: #dc2626;
}

/* Search Box */
.search-box {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  background: var(--color-bg-tertiary);
  border: 2px solid var(--color-border);
  border-radius: 10px;
  margin-bottom: 16px;
}

.search-box input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: 14px;
  color: var(--color-text-primary);
  outline: none;
}

/* Search Results */
.search-results {
  max-height: 300px;
  overflow-y: auto;
  margin-bottom: 20px;
}

.user-result-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  cursor: pointer;
  border-radius: 8px;
  transition: background 0.15s;
}

.user-result-item:hover {
  background: var(--color-bg-tertiary);
}

.search-loading,
.search-empty,
.search-hint {
  padding: 40px 20px;
  text-align: center;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.search-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.spinner-small {
  width: 24px;
  height: 24px;
  border: 3px solid var(--color-border);
  border-top-color: var(--color-primary, #5b6b8f);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Message Form */
.message-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.message-textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--color-border);
  border-radius: 10px;
  font-size: 14px;
  color: var(--color-text-primary);
  background: var(--color-bg-primary);
  resize: vertical;
  font-family: inherit;
  min-height: 100px;
}

.message-textarea:focus {
  outline: none;
  border-color: var(--color-primary, #5b6b8f);
}

.message-form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* Loading/Empty States */
.loading-state,
.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  padding: 40px;
  color: var(--color-text-secondary);
}

.empty-state svg {
  color: var(--color-text-tertiary);
  opacity: 0.5;
}

/* ===== MOBILE MESSAGING ===== */
@media (max-width: 768px) {
  /* Panel principal - Fullscreen en mobile */
  .messages-panel {
    position: fixed !important;
    top: 56px !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 56px) !important;
    min-height: calc(100vh - 56px) !important;
    max-height: calc(100vh - 56px) !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column;
    background: var(--color-bg-primary);
    z-index: 50 !important;
  }
  /* ===== AJUSTAR DASHBOARD CONTENT PARA MENSAJES ===== */
  .universal-dashboard__content:has(.messages-panel) {
    padding: 0 !important;
    margin: 0 !important;
    overflow: hidden !important;
    scrollbar-gutter: auto !important;
    overscroll-behavior-y: none !important;
  }

  /* Mobile Sidebar - Fullscreen cuando visible */
  .messages-sidebar-mobile,
  .messages-sidebar {
    width: 100% !important;
    height: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column;
    background: var(--color-bg-primary);
  }

  /* Mobile Main Thread - Fullscreen cuando visible */
  .messages-main-mobile,
  .messages-main {
    width: 100% !important;
    height: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column;
    background: var(--color-bg-primary);
  }

  /* ===== MESSAGE THREAD - Flexbox correcto, altura completa ===== */
  .message-thread {
    display: flex !important;
    flex-direction: column;
    width: 100% !important;
    height: 100% !important;
    overflow: hidden !important;
    padding: 0 !important;
    margin: 0 !important;
    gap: 0 !important;
  }

  /* ===== SIDEBAR HEADER - Fixed height, visible ===== */
  .messages-sidebar-header {
    flex-shrink: 0 !important;
    padding: 12px 16px !important;
    min-height: 60px !important;
    max-height: 60px !important;
    height: 60px !important;
    border: none !important;
    border-bottom: 1px solid var(--color-border) !important;
    background: var(--color-bg-secondary) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
  }

  .header-title {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .header-title h2 {
    font-size: 20px;
    margin: 0;
    color: var(--color-text-primary);
  }

  .btn-new-message {
    min-width: 44px;
    min-height: 44px;
    padding: 12px;
  }

  /* ===== BÚSQUEDA - Fixed height ===== */
  .messages-search {
    flex-shrink: 0 !important;
    padding: 8px 16px;
    min-height: 52px;
    max-height: 52px;
    border: none;
  }

  /* ===== LISTA DE CONVERSACIONES - Resto del espacio con scroll ===== */
  .conversations-list {
    flex: 1 1 auto !important;
    min-height: 0 !important; /* CRÍTICO para que flex funcione con scroll */
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding: 0 !important;
    margin: 0 !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Conversation items - Sin padding lateral innecesario */
  .conversation-item {
    padding: 12px 16px;
    min-height: 72px;
    border-left: none !important;
    border-right: none !important;
    margin: 0;
  }

  .conversation-item:first-child {
    border-top: none !important;
  }

  .conversation-avatar {
    width: 48px;
    height: 48px;
    font-size: 20px;
  }

  /* ===== THREAD HEADER - Fixed height, visible ===== */
  .thread-header {
    flex-shrink: 0 !important;
    padding: 10px 16px !important;
    min-height: 60px !important;
    max-height: 60px !important;
    height: 60px !important;
    gap: 12px !important;
    border: none !important;
    border-bottom: 1px solid var(--color-border) !important;
    background: var(--color-bg-secondary) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
  }

  /* Botón Back - Touch target, visible */
  .thread-back-btn {
    min-width: 44px;
    min-height: 44px;
    padding: 10px;
    background: transparent;
    border: none;
    border-radius: 10px;
    color: var(--color-text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex !important;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .thread-back-btn:active {
    background: var(--color-bg-tertiary);
    transform: scale(0.95);
  }

  /* Thread user info */
  .thread-user-info {
    flex: 1;
    min-width: 0;
    gap: 10px;
    display: flex;
    align-items: center;
  }

  .thread-avatar {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }

  .thread-user-details h3 {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    color: var(--color-text-primary);
  }

  .thread-user-email {
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--color-text-secondary);
  }

  /* Thread actions */
  .thread-actions {
    gap: 8px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .thread-menu-btn {
    min-width: 44px;
    min-height: 44px;
    padding: 10px;
  }

  /* Menu dropdown */
  .thread-menu {
    right: 0;
    top: calc(100% + 4px);
    min-width: 220px;
  }

  .menu-divider {
    height: 1px;
    background: var(--color-border);
    margin: 8px 0;
  }

  /* ===== SEARCH BAR - Fixed height si visible ===== */
  .thread-search-bar {
    position: relative !important;
    flex-shrink: 0 !important;
    padding: 12px 16px;
    min-height: 60px;
    max-height: 60px;
    border-bottom: 1px solid var(--color-border);
    background: var(--color-bg-secondary);
  }

  /* ===== BÚSQUEDA - Fixed height ===== */
  .messages-search {
    position: relative !important;
    flex-shrink: 0 !important;
    padding: 8px 16px;
    min-height: 52px;
    max-height: 52px;
    border: none;
    background: var(--color-bg-secondary);
  }

  /* ===== MESSAGES LIST - Resto del espacio con scroll ===== */
  .messages-list {
    flex: 1 1 auto !important;
    min-height: 0 !important; /* CRÍTICO para que flex funcione con scroll */
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding: 16px !important;
    margin: 0 !important;
    -webkit-overflow-scrolling: touch;
    /* SOLO ESTE ELEMENTO HACE SCROLL */
  }

  /* Message bubbles */
  .message-bubble {
    max-width: 85%;
  }

  /* ===== INPUT CONTAINER - Fixed height al final, pegado al bottom ===== */
  .message-input-container {
    position: relative !important;
    flex-shrink: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    background: var(--color-bg-secondary);
    border: none !important;
    border-top: 1px solid var(--color-border);
    border-bottom: none !important;
  }

  /* Input area mobile - 1 fila simplificada */
  .input-area-mobile {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Una sola fila: Emoji + Textarea + Send */
  .input-row {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    padding: 12px 16px !important;
    min-height: 60px !important;
    max-height: 60px !important;
    margin: 0 !important;
    background: var(--color-bg-secondary) !important;
  }

  .input-action-btn {
    min-width: 44px !important;
    min-height: 44px !important;
    padding: 10px !important;
    background: transparent !important;
    border: none !important;
    border-radius: 10px !important;
    color: var(--color-text-primary) !important;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0 !important;
  }

  .input-action-btn:active {
    background: var(--color-bg-tertiary) !important;
    transform: scale(0.95);
  }

  .input-action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .message-input {
    flex: 1 !important;
    min-height: 36px !important;
    max-height: 36px !important;
    height: 36px !important;
    padding: 8px 12px !important;
    font-size: 16px !important; /* Evitar zoom en iOS */
    resize: none !important;
    border: 1px solid var(--color-border) !important;
    border-radius: 18px !important;
    line-height: 20px !important;
    overflow: hidden !important;
  }

  .send-button,
  .voice-button {
    min-width: 44px !important;
    min-height: 44px !important;
    padding: 10px !important;
    flex-shrink: 0 !important;
  }

  /* Textarea wrapper en mobile */
  .textarea-wrapper {
    flex: 1 !important;
  }

  .textarea-wrapper .message-input {
    padding: 8px 70px 8px 45px !important; /* Espacio para botones internos en mobile */
  }

  /* Botones internos en mobile */
  .inner-input-buttons {
    padding: 0 8px !important;
  }

  .inner-input-btn {
    padding: 4px !important;
    min-width: 32px !important;
    min-height: 32px !important;
  }

  /* Reply/Edit bars */
  .reply-bar,
  .edit-bar {
    flex-shrink: 0;
    padding: 8px 16px;
    min-height: 48px;
    border-bottom: 1px solid var(--color-border);
  }

  /* File preview */
  .file-preview-container {
    flex-shrink: 0;
    padding: 8px 16px;
    min-height: 60px;
    border-bottom: 1px solid var(--color-border);
  }

  /* ===== NEW MESSAGE MODAL ===== */
  .new-message-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-height: 100vh !important;
    border-radius: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    z-index: 1100;
  }

  /* ===== TRANSITIONS ===== */
  .messages-sidebar-mobile,
  .messages-main-mobile {
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
}

/* Dark Mode */
.dark .conversation-item.selected {
  background: rgba(99, 102, 241, 0.15);
}

.dark .conversation-item.unread {
  background: rgba(99, 102, 241, 0.1);
}

.dark .message-bubble-container.other .message-bubble {
  background: var(--color-bg-tertiary);
}

/* ===== Typing Indicator ===== */
.typing-indicator {
  display: flex;
  align-items: flex-end;
  gap: 10px;
  padding: 8px 0;
  animation: fadeIn 0.3s ease;
}

.typing-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 700;
  flex-shrink: 0;
}

.typing-bubble {
  background: var(--color-bg-secondary);
  border-radius: 16px;
  border-bottom-left-radius: 4px;
  padding: 12px 16px;
  display: flex;
  gap: 4px;
  align-items: center;
  min-width: 60px;
}

.typing-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-text-secondary);
  animation: typingBounce 1.4s infinite;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typingBounce {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.7;
  }
  30% {
    transform: translateY(-10px);
    opacity: 1;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ===== File Attachments ===== */
.file-preview-container {
  padding: 12px;
  border-top: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
}

.image-preview {
  position: relative;
  display: inline-block;
  max-width: 200px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.image-preview img {
  width: 100%;
  height: auto;
  display: block;
}

.remove-preview-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  padding: 6px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.remove-preview-btn:hover {
  background: rgba(239, 68, 68, 0.9);
  transform: scale(1.1);
}

.file-preview {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: 10px;
}

.file-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.file-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--color-text-primary);
  word-break: break-word;
}

.file-size {
  font-size: 12px;
  color: var(--color-text-secondary);
}

.input-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ===== Textarea Wrapper (con botones internos) ===== */
.textarea-wrapper {
  position: relative;
  flex: 1;
  display: flex;
}

.textarea-wrapper .message-input {
  flex: 1;
  padding: 12px 80px 12px 50px; /* Espacio para botones internos */
  border: 2px solid var(--color-border);
  border-radius: 12px;
  font-size: 14px;
  resize: none;
  transition: border-color 0.2s, padding 0.3s;
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
}

.textarea-wrapper .message-input:focus {
  outline: none;
  border-color: var(--color-primary, #5b6b8f);
}

/* Botones internos del textarea */
.inner-input-buttons {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 12px;
  pointer-events: none; /* No bloquear clicks en el textarea */
  z-index: 1;
}

.inner-buttons-left,
.inner-buttons-right {
  display: flex;
  gap: 6px;
  pointer-events: auto; /* Habilitar clicks en los botones */
}

.inner-input-btn {
  padding: 6px;
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.7;
}

.inner-input-btn:hover:not(:disabled) {
  background: var(--color-bg-secondary);
  color: var(--color-primary, #5b6b8f);
  opacity: 1;
  transform: scale(1.1);
}

.inner-input-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Ajuste del voice-button para que sea igual al send-button */
.voice-button {
  min-width: 48px;
  min-height: 48px;
  padding: 12px;
  background: var(--color-primary, #5b6b8f);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.voice-button:hover:not(:disabled) {
  background: var(--color-primary-dark, #4a5a7a);
  transform: translateY(-2px);
}

.voice-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.attach-button {
  padding: 10px;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: 10px;
  color: var(--color-text-primary);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.attach-button:hover:not(:disabled) {
  background: var(--color-primary, #5b6b8f);
  color: white;
  border-color: var(--color-primary, #5b6b8f);
  transform: scale(1.05);
}

.attach-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.emoji-button {
  padding: 10px;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: 10px;
  color: var(--color-text-primary);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.emoji-button:hover:not(:disabled) {
  background: var(--color-primary, #5b6b8f);
  color: white;
  border-color: var(--color-primary, #5b6b8f);
  transform: scale(1.05);
}

.emoji-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ===== Emoji Picker ===== */
.emoji-picker {
  position: absolute;
  bottom: 70px;
  left: 20px;
  width: 280px;
  max-height: 420px;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  z-index: 1000;
  animation: slideUp 0.2s ease;
}

.emoji-picker-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 2px solid var(--color-border);
  background: var(--color-bg-tertiary);
  border-radius: 14px 14px 0 0;
}

.emoji-picker-title {
  font-weight: 600;
  font-size: 14px;
  color: var(--color-text-primary);
}

.emoji-picker-close {
  background: none;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
  border-radius: 6px;
  transition: all 0.2s;
}

.emoji-picker-close:hover {
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.emoji-categories {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  padding: 10px 12px;
  border-bottom: 1px solid var(--color-border);
}

.emoji-category-btn {
  padding: 8px 12px;
  background: transparent;
  border: none;
  border-radius: 8px;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
}

.emoji-category-btn:hover {
  background: var(--color-bg-hover);
  transform: scale(1.1);
}

.emoji-category-btn.active {
  background: var(--color-bg-tertiary);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.emoji-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 3px;
  padding: 12px;
  overflow-y: auto;
  max-height: 280px;
}

.emoji-grid::-webkit-scrollbar {
  width: 8px;
}

.emoji-grid::-webkit-scrollbar-track {
  background: var(--color-bg-primary);
  border-radius: 4px;
}

.emoji-grid::-webkit-scrollbar-thumb {
  background: var(--color-bg-tertiary);
  border-radius: 4px;
}

.emoji-grid::-webkit-scrollbar-thumb:hover {
  background: var(--color-bg-hover);
}

.emoji-btn {
  padding: 8px;
  background: transparent;
  border: none;
  border-radius: 8px;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.emoji-btn:hover {
  background: var(--color-bg-tertiary);
  transform: scale(1.2);
}

.emoji-btn:active {
  transform: scale(1.1);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ===== TABLET MESSAGING (769px - 1024px) ===== */
@media (min-width: 769px) and (max-width: 1024px) {
  /* Panel principal - Layout de 2 columnas en tablet */
  .messages-panel {
    display: flex !important;
    flex-direction: row !important;
    height: 100% !important;
    min-height: 600px !important;
  }

  /* Sidebar - Más estrecho en tablet */
  .messages-sidebar {
    width: 300px !important;
    min-width: 300px !important;
    max-width: 300px !important;
    border-right: 1px solid var(--color-border) !important;
    flex-shrink: 0 !important;
  }

  /* Main thread - Ocupa el resto del espacio */
  .messages-main {
    flex: 1 !important;
    min-width: 0 !important; /* Importante para que flex funcione */
  }

  /* Ajustar header de sidebar */
  .messages-sidebar-header {
    padding: 16px !important;
  }

  .header-title h2 {
    font-size: 18px !important;
  }

  /* Ajustar items de conversación */
  .conversation-item {
    padding: 14px 16px !important;
  }

  .conversation-avatar {
    width: 44px !important;
    height: 44px !important;
  }

  /* Ajustar thread header */
  .thread-header {
    padding: 16px !important;
  }

  /* Ajustar burbuja de mensaje */
  .message-bubble {
    max-width: 70% !important;
  }

  /* Ajustar input area */
  .message-input-container {
    padding: 16px !important;
  }

  /* Ajustar botones de acción en thread */
  .thread-action-btn {
    padding: 8px !important;
  }
}

/* ===== DESKTOP MESSAGING (1025px+) ===== */
@media (min-width: 1025px) {
  /* Panel principal - Layout de 2 columnas optimizado */
  .messages-panel {
    display: flex !important;
    flex-direction: row !important;
  }

  /* Sidebar - Ancho óptimo en desktop */
  .messages-sidebar {
    width: 360px !important;
    min-width: 360px !important;
    max-width: 360px !important;
    flex-shrink: 0 !important;
  }

  /* Main thread - Resto del espacio */
  .messages-main {
    flex: 1 !important;
    min-width: 0 !important;
  }
}

/* Responsive Emoji Picker */
@media (max-width: 768px) {
  .emoji-picker {
    left: 10px;
    right: 10px;
    width: auto;
  }

  .emoji-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* voice-button moved to line 3878 - unified with send-button style */

/* Message Attachments Display */
.message-attachment {
  margin-bottom: 8px;
}

.attachment-image {
  max-width: 300px;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
}

.attachment-image img {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.2s;
}

.attachment-image:hover img {
  transform: scale(1.02);
}

.attachment-file {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: 10px;
  text-decoration: none;
  color: var(--color-text-primary);
  transition: all 0.2s;
  max-width: 300px;
}

.attachment-file:hover {
  background: var(--color-bg-secondary);
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.attachment-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

.attachment-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--color-text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.attachment-size {
  font-size: 12px;
  color: var(--color-text-secondary);
}

/* Audio Attachment - Custom Player - Diseño Minimalista */
.attachment-audio-custom {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0; /* Sin padding horizontal, sin fondo */
  background: transparent; /* Fondo transparente - heredará el color de la burbuja */
  border: none; /* Sin bordes */
  border-radius: 0;
  min-width: 240px;
  max-width: 380px;
}

/* Play button más pequeño y minimalista */
.audio-play-btn {
  flex-shrink: 0;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  /* Color adaptativo según tipo de mensaje */
  background: rgba(255, 255, 255, 0.25);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

/* En mensajes de otros, usar el color primario */
.message-bubble-container.other .audio-play-btn {
  background: var(--color-primary, #5b6b8f);
  color: white;
}

.audio-play-btn:hover {
  opacity: 0.9;
  transform: scale(1.05);
}

.audio-play-btn:active {
  transform: scale(0.95);
}

.audio-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 0;
}

/* Barra de progreso más sutil */
.audio-progress-bar {
  height: 4px; /* Más delgada */
  background: rgba(0, 0, 0, 0.15); /* Fondo sutil */
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

/* Barra de progreso en mensajes propios (fondo azul) */
.message-bubble-container.own .audio-progress-bar {
  background: rgba(255, 255, 255, 0.3);
}

/* Barra de progreso en mensajes de otros */
.message-bubble-container.other .audio-progress-bar {
  background: rgba(0, 0, 0, 0.1);
}

.audio-progress-fill {
  height: 100%;
  background: rgba(255, 255, 255, 0.9); /* Blanco para mensajes propios */
  border-radius: 2px;
  transition: none;
}

/* Fill en mensajes de otros */
.message-bubble-container.other .audio-progress-fill {
  background: var(--color-primary, #5b6b8f);
}

/* Tiempos más pequeños y sutiles */
.audio-time {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: currentColor;
  opacity: 0.75;
  font-family: monospace;
}

.audio-duration-text {
  opacity: 0.6;
}

/* Dark Mode Adjustments */
.dark .file-preview {
  background: var(--color-bg-secondary);
  border-color: var(--color-border);
}

.dark .attach-button {
  background: var(--color-bg-tertiary);
}

.dark .attachment-file {
  background: rgba(255, 255, 255, 0.05);
}

.dark .attachment-file:hover {
  background: rgba(255, 255, 255, 0.08);
}

/* ===== Reply and Edit Bars ===== */
.reply-bar,
.edit-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--color-bg-tertiary);
  border-left: 4px solid var(--color-primary, #5b6b8f);
  margin-bottom: 8px;
  border-radius: 8px;
}

.edit-bar {
  border-left-color: #f59e0b;
}

.reply-bar-content,
.edit-bar-content {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.reply-info,
.edit-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.reply-info strong,
.edit-info strong {
  font-size: 13px;
  font-weight: 600;
  color: var(--color-text-primary);
}

.reply-info p,
.edit-info p {
  font-size: 12px;
  color: var(--color-text-secondary);
  margin: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 300px;
}

.reply-bar-close,
.edit-bar-close {
  padding: 4px;
  background: transparent;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reply-bar-close:hover,
.edit-bar-close:hover {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
}

/* ===== Message Context Menu ===== */
.message-actions-container {
  position: absolute;
  top: 4px;
  right: 4px;
  opacity: 0;
  transition: opacity 0.2s;
}

.message-bubble:hover .message-actions-container {
  opacity: 1;
}

.message-menu-btn {
  padding: 4px;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: 50%;
  color: var(--color-text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.message-menu-btn:hover {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  transform: scale(1.1);
}

.message-context-menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 4px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  min-width: 180px;
  overflow: hidden;
  z-index: 1000;
  animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message-context-menu button {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  background: transparent;
  border: none;
  color: var(--color-text-primary);
  font-size: 14px;
  text-align: left;
  cursor: pointer;
  transition: background 0.15s;
}

.message-context-menu button:hover {
  background: var(--color-bg-tertiary);
}

.message-context-menu button:active {
  background: var(--color-bg-secondary);
}

/* ===== Message Footer (Time + Checkmarks) ===== */
.message-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 4px;
  margin-top: 4px; /* Separación consistente del contenido */
  white-space: nowrap;
  font-size: 11px;
  opacity: 0.8;
}

.message-time {
  color: var(--color-text-tertiary);
  display: inline-flex;
  align-items: center;
  gap: 3px;
  white-space: nowrap;
}

/* Color más claro para mensajes propios (sobre fondo azul) */
.message-bubble-container.own .message-time {
  color: rgba(255, 255, 255, 0.75);
}

.edited-indicator {
  font-style: italic;
  opacity: 0.8;
  font-size: 10px; /* Aumentado para mejor legibilidad */
}

.message-status {
  display: inline-flex;
  align-items: center;
  gap: 1px;
}

.status-icon {
  flex-shrink: 0;
}

.status-icon.sent {
  color: rgba(255, 255, 255, 0.7);
}

.status-icon.delivered {
  color: rgba(255, 255, 255, 0.7);
}

.status-icon.read {
  color: #93c5fd; /* Azul claro para destacar sobre el fondo azul */
}

/* ===== Reply Preview in Messages ===== */
.message-reply-preview {
  background: var(--color-bg-tertiary);
  border-left: 3px solid var(--color-primary, #5b6b8f);
  border-radius: 6px;
  padding: 8px 12px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.message-reply-preview:hover {
  background: var(--color-bg-secondary);
  transform: translateX(2px);
}

.reply-line {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--color-primary, #5b6b8f);
  border-radius: 2px 0 0 2px;
}

.reply-content {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.reply-content strong {
  font-size: 12px;
  font-weight: 600;
  color: var(--color-primary, #5b6b8f);
}

.reply-content p {
  font-size: 12px;
  color: var(--color-text-secondary);
  margin: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 250px;
}

/* ===== Deleted Message Styles ===== */
.message-bubble-container.deleted .message-bubble {
  opacity: 0.6;
  font-style: italic;
}

.message-bubble-container.deleted .message-content {
  color: var(--color-text-tertiary);
}

/* ===== Dark Mode Adjustments for New Features ===== */
.dark .reply-bar,
.dark .edit-bar {
  background: rgba(255, 255, 255, 0.05);
}

.dark .message-menu-btn {
  background: rgba(255, 255, 255, 0.1);
}

.dark .message-context-menu {
  background: var(--color-bg-secondary);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

.dark .message-reply-preview {
  background: rgba(255, 255, 255, 0.05);
}

.dark .message-reply-preview:hover {
  background: rgba(255, 255, 255, 0.08);
}

/* ===== Drag & Drop Overlay ===== */
.drag-drop-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(99, 102, 241, 0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.2s ease-out;
}

.drag-drop-content {
  text-align: center;
  color: white;
}

.drag-drop-content svg {
  margin-bottom: 16px;
  animation: bounce 1s ease-in-out infinite;
}

.drag-drop-content h3 {
  font-size: 24px;
  font-weight: 600;
  margin: 0 0 8px 0;
}

.drag-drop-content p {
  font-size: 16px;
  opacity: 0.9;
  margin: 0;
}

@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* ===== Image Lightbox ===== */
.image-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.2s ease-out;
}

.lightbox-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
}

.lightbox-content {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  z-index: 1;
}

.lightbox-content img {
  max-width: 100%;
  max-height: calc(90vh - 80px);
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

.lightbox-close {
  position: absolute;
  top: -40px;
  right: 0;
  padding: 8px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.lightbox-close:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

.lightbox-info {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  color: white;
}

.lightbox-download {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--color-primary, #5b6b8f);
  border-radius: 6px;
  color: white;
  text-decoration: none;
  font-size: 14px;
  transition: all 0.2s;
}

.lightbox-download:hover {
  background: var(--color-primary-dark, #4a5a7a);
  transform: translateY(-2px);
}

/* ===== Starred Messages ===== */
.message-star-btn {
  padding: 4px;
  background: transparent;
  border: none;
  color: var(--color-text-tertiary);
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.message-star-btn:hover {
  background: var(--color-bg-tertiary);
  color: #f59e0b;
}

.message-star-btn.starred {
  color: #f59e0b;
}

.starred-indicator {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  color: #f59e0b;
  margin-top: 4px;
}

/* ===== Forwarded Messages ===== */
.message-forwarded-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--color-text-tertiary);
  font-style: italic;
  margin-bottom: 6px;
  padding: 4px 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  border-left: 2px solid var(--color-primary, #5b6b8f);
}

.message-forwarded-indicator svg {
  flex-shrink: 0;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .attachment-image {
    max-width: 100%;
  }

  .attachment-file {
    max-width: 100%;
  }

  .lightbox-content {
    max-width: 95vw;
    max-height: 95vh;
  }

  .lightbox-content img {
    max-height: calc(95vh - 60px);
  }

  .drag-drop-content h3 {
    font-size: 20px;
  }

  .drag-drop-content p {
    font-size: 14px;
  }
}

/* ===== Search Within Conversation ===== */
.thread-action-btn {
  padding: 8px;
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.thread-action-btn:hover {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.thread-search-bar {
  padding: 12px 16px;
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideDown 0.3s ease;
}

.search-input-container {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--color-bg-primary);
  border: 2px solid var(--color-border);
  border-radius: 8px;
  transition: border-color 0.2s;
}

.search-input-container:focus-within {
  border-color: var(--color-primary, #5b6b8f);
}

.search-input-container input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: 14px;
  color: var(--color-text-primary);
  outline: none;
}

.clear-search-btn {
  padding: 4px;
  background: none;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  border-radius: 4px;
  transition: all 0.2s;
}

.clear-search-btn:hover {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.search-navigation {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 8px;
  background: var(--color-bg-tertiary);
  border-radius: 8px;
}

.search-count {
  font-size: 13px;
  font-weight: 600;
  color: var(--color-text-secondary);
  min-width: 50px;
  text-align: center;
}

.search-nav-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  color: var(--color-text-primary);
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s;
}

.search-nav-btn:hover {
  background: var(--color-primary, #5b6b8f);
  color: white;
  border-color: var(--color-primary, #5b6b8f);
  transform: scale(1.05);
}

.search-no-results {
  padding: 8px 12px;
  font-size: 13px;
  color: var(--color-text-secondary);
  font-style: italic;
}

/* Search Result Highlighting */
.message-bubble-container.search-result {
  animation: searchPulse 0.5s ease;
}

.message-bubble-container.current-search-result .message-bubble {
  border: 2px solid var(--color-primary, #5b6b8f);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.search-highlight {
  background: #fef08a;
  color: #854d0e;
  padding: 2px 4px;
  border-radius: 3px;
  font-weight: 600;
}

.dark .search-highlight {
  background: #ca8a04;
  color: #fef3c7;
}

@keyframes searchPulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Dark Mode Search Adjustments */
.dark .thread-search-bar {
  background: var(--color-bg-tertiary);
}

.dark .search-input-container {
  background: var(--color-bg-tertiary);
}

/* Responsive Search */
@media (max-width: 768px) {
  .thread-search-bar {
    flex-wrap: wrap;
  }

  .search-navigation {
    width: 100%;
    justify-content: center;
  }
}

/* ===== Message Reactions ===== */
.message-reactions {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 8px;
}

.reaction-item {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: var(--color-bg-tertiary);
  border: 2px solid var(--color-border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
}

.reaction-item:hover {
  transform: scale(1.1);
  border-color: var(--color-primary, #5b6b8f);
}

.reaction-item.reacted {
  background: var(--color-primary, #5b6b8f);
  border-color: var(--color-primary, #5b6b8f);
  color: white;
}

.reaction-emoji {
  font-size: 16px;
  line-height: 1;
}

.reaction-count {
  font-size: 12px;
  font-weight: 700;
  min-width: 14px;
  text-align: center;
}

.reaction-button-container {
  display: inline-block;
  margin-top: 4px;
}

.add-reaction-btn {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 700;
  opacity: 0;
}

.message-bubble:hover .add-reaction-btn {
  opacity: 1;
}

.add-reaction-btn:hover {
  background: var(--color-primary, #5b6b8f);
  color: white;
  border-color: var(--color-primary, #5b6b8f);
  transform: scale(1.1);
}

/* Dark Mode Reactions */
.dark .reaction-item {
  background: rgba(255, 255, 255, 0.1);
}

.dark .reaction-item.reacted {
  background: var(--color-primary, #5b6b8f);
}
/**
 * Content Manager Tabs - Estilos
 */

/* ============================================
   CONTENT MANAGER TABS
   ============================================
   DEPRECATED: Ahora usa BaseTabs (migrado en Fase 2)
   Estos estilos se mantienen temporalmente por compatibilidad
   pero pueden eliminarse en el futuro.
   ============================================ */

/* ============================================
   CALENDAR VIEW - ESTILOS CONSISTENTES
   ============================================ */

.calendar-view {
  padding: 0;
}

/* Loading State */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  gap: 16px;
}

.spinner {
  width: 48px;
  height: 48px;
  border: 4px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Calendar Grid */
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 16px;
  margin-top: 24px;
}

.calendar-day-card {
  background: var(--color-card-bg);
  border: 2px solid var(--color-border);
  border-radius: 12px;
  padding: 16px;
  min-height: 200px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.calendar-day-card:hover {
  border-color: var(--color-primary);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
}

.calendar-day-card.today {
  border-color: var(--color-primary);
  background: var(--color-primary-light);
  box-shadow: 0 0 0 1px var(--color-primary);
}

/* Day Header */
.day-header {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--color-border);
  margin-bottom: 12px;
}

.day-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.day-date {
  font-size: 13px;
  color: var(--color-text-secondary);
}

.calendar-day-card.today .day-name {
  color: var(--color-primary);
}

/* Day Sessions */
.day-sessions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.no-sessions {
  color: var(--color-text-secondary);
  font-size: 14px;
  font-style: italic;
  text-align: center;
  padding: 20px 0;
}

.session-item {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  transition: all 0.2s ease;
}

.session-item:hover {
  border-color: var(--color-primary);
  background: var(--color-primary-light);
}

.session-time {
  font-size: 13px;
  font-weight: 600;
  color: var(--color-primary);
}

.session-group {
  font-size: 13px;
  color: var(--color-text-primary);
}

/* Responsive */
@media (max-width: 1400px) {
  .calendar-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (max-width: 1024px) {
  .calendar-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px) {
  .calendar-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .calendar-day-card {
    min-height: 150px;
    padding: 12px;
  }
}

@media (max-width: 480px) {
  .calendar-grid {
    grid-template-columns: 1fr;
  }
}
/* ============================================
   ATTENDANCE VIEW - ESTILOS MINIMALISTAS
   ============================================ */

.attendance-view {
  animation: fadeIn 0.3s ease-out;
}

.attendance-view.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  gap: 16px;
}

/* Header */
.attendance-header {
  margin-bottom: 24px;
}

.attendance-title {
  font-size: 24px;
  font-weight: 800;
  color: var(--color-text-primary);
  margin: 0 0 16px 0;
}

.attendance-stats {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.stat-item {
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  min-width: 120px;
}

.stat-item.stat-present {
  background: var(--color-success-bg);
}

.stat-item.stat-pending {
  background: var(--color-warning-bg);
}

.stat-item.stat-percentage {
  background: var(--color-info-bg);
}

.stat-value {
  font-size: 28px;
  font-weight: 800;
  color: var(--color-text-primary);
  line-height: 1;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Message */
.attendance-message {
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.attendance-message.success {
  background: var(--color-success-bg);
  color: var(--color-success-dark);
}

.attendance-message.error {
  background: var(--color-error-bg);
  color: var(--color-error-dark);
}

/* Content Layout */
.attendance-content {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 24px;
}

/* Sessions Sidebar */
.sessions-sidebar {
  background: var(--color-bg-secondary);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  max-height: 600px;
  overflow-y: auto;
}

.sidebar-title {
  font-size: 16px;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 16px 0;
}

.sessions-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.session-item {
  padding: 12px;
  background: var(--color-bg-tertiary);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  border-left: 3px solid transparent;
}

.session-item:hover {
  background: var(--color-bg-hover);
}

.session-item.selected {
  background: var(--color-bg-hover);
  border-left-color: var(--color-border-focus);
}

.session-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 4px;
}

.session-group {
  font-size: 12px;
  color: var(--color-text-secondary);
  margin-bottom: 4px;
}

.session-datetime {
  font-size: 11px;
  color: var(--color-text-secondary);
  text-transform: capitalize;
}

/* Attendance Detail */
.attendance-detail {
  background: var(--color-bg-secondary);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  min-height: 400px;
}

.detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--color-border);
  flex-wrap: wrap;
  gap: 16px;
}

.detail-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0;
}

.detail-subtitle {
  font-size: 14px;
  color: var(--color-text-secondary);
  margin: 4px 0 0 0;
}

/* Students List */
.students-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.student-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: var(--color-bg-tertiary);
  border-radius: 10px;
  transition: all 0.2s ease;
}

.student-item:hover {
  background: var(--color-bg-hover);
  transform: translateX(2px);
}

.student-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.student-avatar {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-tertiary);
  border-radius: 50%;
  font-size: 20px;
  flex-shrink: 0;
}

.student-details {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.student-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--color-text-primary);
}

.link-clicked-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  background: var(--color-success-bg);
  color: var(--color-success-dark);
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
}

/* Status Badge */
.status-badge {
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
}

.status-badge.status-present {
  background: var(--color-success-bg);
  color: var(--color-success-dark);
}

.status-badge.status-absent {
  background: var(--color-error-bg);
  color: var(--color-error-dark);
}

.status-badge.status-late {
  background: var(--color-warning-bg);
  color: var(--color-warning-dark);
}

.status-badge.status-excused {
  background: var(--color-info-bg);
  color: var(--color-info-dark);
}

.status-badge.status-pending {
  background: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

/* Empty States */
.empty-sessions,
.empty-students {
  text-align: center;
  padding: 60px 20px;
  background: var(--color-bg-tertiary);
  border-radius: 12px;
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.empty-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 8px 0;
}

.empty-text {
  font-size: 14px;
  color: var(--color-text-secondary);
  margin: 0;
}

.empty-students {
  padding: 40px 20px;
}

.empty-students p {
  color: var(--color-text-secondary);
  margin: 0;
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Responsive */
@media (max-width: 1024px) {
  .attendance-content {
    grid-template-columns: 1fr;
  }

  .sessions-sidebar {
    max-height: none;
  }

  .detail-header {
    flex-direction: column;
    align-items: flex-start;
  }
}

@media (max-width: 768px) {
  .attendance-stats {
    width: 100%;
  }

  .stat-item {
    flex: 1;
    min-width: auto;
  }

  .student-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .student-status {
    width: 100%;
  }

  .status-badge {
    display: block;
    text-align: center;
  }
}

/* ============================================
   CREDIT MANAGER - ESTILOS MINIMALISTAS
   ============================================ */

.credit-manager {
  animation: fadeIn 0.3s ease-out;
}

.credit-manager.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  gap: 16px;
}

/* Message */
.credit-message {
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.credit-message.success {
  background: #d1fae5;
  color: #065f46;
}

.credit-message.error {
  background: #fee2e2;
  color: #991b1b;
}

/* Stats Grid */
.credit-stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 24px;
}

.credit-stat-card {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
  border-radius: 12px;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  transition: all 0.2s ease;
}

.credit-stat-card:hover {
  border-color: var(--color-border-focus);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.credit-stat-card .stat-icon {
  font-size: 0;
  line-height: 0;
}

.credit-stat-card .stat-icon svg {
  color: var(--color-text-secondary);
  width: 24px;
  height: 24px;
}

.credit-stat-card .stat-value {
  font-size: 28px;
  font-weight: 700;
  color: var(--color-text-primary);
  line-height: 1;
  margin: 0;
}

.credit-stat-card .stat-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 0;
}

/* Actions */
.credit-actions {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  flex-wrap: wrap;
  align-items: stretch;
}

.credit-actions .btn {
  white-space: nowrap;
  padding: 10px 20px !important;
  min-height: 42px !important;
  height: 42px;
  line-height: 1.5;
  font-size: 16px;
}

/* Notes Section */
.credit-notes-section {
  padding: 20px;
  background: var(--color-background, #f9fafb);
  border-radius: 12px;
  margin-bottom: 24px;
}

.notes-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.notes-title {
  font-size: 16px;
  font-weight: 700;
  color: var(--color-text-primary, #1f2937);
  margin: 0;
}

.btn-group-sm {
  display: flex;
  gap: 8px;
}

.btn-sm {
  padding: 6px 12px;
  font-size: 13px;
}

.notes-textarea {
  width: 100%;
  padding: 12px 16px;
  font-size: 14px;
  border: none;
  border-radius: 10px;
  background: var(--color-bg-secondary);
  color: var(--color-text-primary, #1f2937);
  resize: vertical;
  min-height: 80px;
  font-family: inherit;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
  box-sizing: border-box;
}

.notes-textarea:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), 0 2px 8px rgba(0, 0, 0, 0.08);
}

.notes-display {
  padding: 12px 16px;
  background: var(--color-bg-secondary);
  border-radius: 10px;
  font-size: 14px;
  color: var(--color-text-primary, #374151);
  min-height: 80px;
  white-space: pre-wrap;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}

/* Transactions Section */
.transactions-section {
  margin-top: 32px;
}

.section-title {
  font-size: 18px;
  font-weight: 700;
  color: #1f2937;
  margin: 0 0 16px 0;
}

.transactions-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.transaction-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  border-radius: 12px;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  transition: all 0.2s ease;
}

.transaction-item:hover {
  border-color: #d1d5db;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.transaction-icon {
  flex-shrink: 0;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f3f4f6;
  border-radius: 10px;
}

.transaction-icon svg {
  color: #5b6b8f;
  width: 22px;
  height: 22px;
}

.transaction-item.purchase .transaction-icon {
  background: #dcfce7;
}

.transaction-item.purchase .transaction-icon svg {
  color: #16a34a;
}

.transaction-item.deduction .transaction-icon,
.transaction-item.class .transaction-icon {
  background: #fef3c7;
}

.transaction-item.deduction .transaction-icon svg,
.transaction-item.class .transaction-icon svg {
  color: #d97706;
}

.transaction-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.transaction-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.transaction-type {
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
}

.transaction-amount {
  font-size: 18px;
  font-weight: 700;
}

.transaction-amount.positive {
  color: #16a34a;
}

.transaction-amount.negative {
  color: #d97706;
}

.transaction-reason {
  font-size: 13px;
  color: #6b7280;
  line-height: 1.4;
}

.transaction-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  margin-top: 4px;
}

.transaction-date {
  font-size: 12px;
  color: #9ca3af;
}

.transaction-balance {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  padding: 4px 10px;
  background: #f3f4f6;
  border-radius: 6px;
}

.empty-transactions {
  text-align: center;
  padding: 40px 20px;
  background: #f9fafb;
  border-radius: 12px;
  color: #6b7280;
  font-size: 14px;
}

/* Modal */
.credit-modal {
  max-width: 500px;
}

.warning-message {
  padding: 12px 16px;
  background: #fef3c7;
  color: #92400e;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  margin-top: 16px;
}

/* Dark Mode */
.dark .credit-stat-card {
  background: var(--color-bg-secondary);
  border-color: var(--color-border);
}

.dark .credit-stat-card:hover {
  border-color: var(--color-border-focus);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.dark .credit-stat-card .stat-icon svg {
  color: var(--color-text-secondary);
}

.dark .credit-stat-card .stat-value {
  color: var(--color-text-primary);
}

.dark .credit-stat-card .stat-label {
  color: var(--color-text-secondary);
}

.dark .credit-notes-section {
  background: rgba(255, 255, 255, 0.05);
}

.dark .notes-textarea,
.dark .notes-display {
  background: rgba(255, 255, 255, 0.08);
  color: var(--color-text-primary);
}

.dark .notes-textarea:focus {
  background: rgba(255, 255, 255, 0.1);
}

.dark .section-title {
  color: #f9fafb;
}

.dark .transaction-item {
  background: #1f2937;
  border-color: #374151;
}

.dark .transaction-item:hover {
  border-color: #4b5563;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.dark .transaction-icon {
  background: #374151;
}

.dark .transaction-icon svg {
  color: #818cf8;
}

.dark .transaction-item.purchase .transaction-icon {
  background: rgba(16, 185, 129, 0.15);
}

.dark .transaction-item.purchase .transaction-icon svg {
  color: #34d399;
}

.dark .transaction-item.deduction .transaction-icon,
.dark .transaction-item.class .transaction-icon {
  background: rgba(245, 158, 11, 0.15);
}

.dark .transaction-item.deduction .transaction-icon svg,
.dark .transaction-item.class .transaction-icon svg {
  color: #fbbf24;
}

.dark .transaction-type {
  color: #f9fafb;
}

.dark .transaction-amount.positive {
  color: #34d399;
}

.dark .transaction-amount.negative {
  color: #fbbf24;
}

.dark .transaction-reason {
  color: #9ca3af;
}

.dark .transaction-date {
  color: #6b7280;
}

.dark .transaction-balance {
  background: #374151;
  color: #d1d5db;
}

.dark .empty-transactions {
  background: #1f2937;
  color: #9ca3af;
}

.dark .warning-message {
  background: rgba(245, 158, 11, 0.15);
  color: #fbbf24;
}

/* Responsive */
@media (max-width: 768px) {
  .credit-actions {
    flex-direction: column;
  }

  .credit-actions .btn {
    width: 100%;
  }

  .transaction-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .transaction-footer {
    flex-direction: column;
    align-items: flex-start;
  }
}

/* ============================================
   UNIVERSAL PANEL BASE STYLES
   Configuración centralizada para TODOS los paneles
   ============================================ */

/**
 * NOTA IMPORTANTE:
 * La mayoría de los paneles NO necesitan clase especial porque
 * .universal-dashboard__content ya tiene padding: 1.5rem
 *
 * Solo usar .universal-panel-standalone para paneles que se
 * renderizan FUERA del UniversalDashboard (ej: modales, popups)
 */

/**
 * Paneles standalone (fuera del UniversalDashboard)
 * Solo usar si el panel NO está dentro de .universal-dashboard__content
 */
.universal-panel-standalone {
  padding: 1.5rem;
  background: var(--color-bg-primary);
}

/**
 * Fix para paneles full-height complejos (Messages, etc.)
 * Estos paneles manejan su propio layout y NO deben tener padding extra
 */
.messages-panel,
.homework-review-modal {
  /* Asegurar que ocupen todo el espacio disponible */
  height: 100%;
  max-height: calc(100vh - 64px - 1.5rem - 1.5rem); /* viewport - topbar - padding top - padding bottom */
}

/* ============================================
   MESSAGING - INFINITE SCROLL
   ============================================ */

/* Loading older messages indicator */
.loading-older-messages {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 1rem;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.loading-older-messages .spinner-small {
  width: 16px;
  height: 16px;
  border: 2px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* No more messages indicator */
.no-more-messages {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  margin: 0.5rem 0;
}

.no-more-messages span {
  padding: 0.5rem 1rem;
  background: var(--color-bg-secondary);
  border-radius: 12px;
  color: var(--color-text-secondary);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.dark .no-more-messages span {
  background: var(--color-bg-tertiary);
}

/* ============================================
   MEDIA GALLERY
   ============================================ */

/* Media Gallery Overlay */
.media-gallery-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1001;
  padding: 2rem;
  animation: fadeIn 0.2s ease-out;
}

/* Media Gallery Container */
.media-gallery {
  background: var(--color-bg-primary);
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  width: 100%;
  max-width: 900px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  animation: slideDown 0.3s ease-out;
}

.dark .media-gallery {
  background: var(--color-bg-secondary);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
}

/* Media Gallery Header */
.media-gallery-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid var(--color-border);
}

.media-gallery-header h2 {
  margin: 0;
  font-size: 1.25rem;
  color: var(--color-text-primary);
}

.media-gallery-close {
  background: none;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 8px;
  transition: all 0.2s;
}

.media-gallery-close:hover {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
}

.dark .media-gallery-close:hover {
  background: var(--color-bg-tertiary);
}

/* Media Gallery Search */
.media-gallery-search {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
}

.dark .media-gallery-search {
  background: var(--color-bg-tertiary);
}

.media-gallery-search svg {
  color: var(--color-text-secondary);
  flex-shrink: 0;
}

.media-gallery-search input {
  flex: 1;
  background: none;
  border: none;
  color: var(--color-text-primary);
  font-size: 14px;
  outline: none;
}

.media-gallery-search input::placeholder {
  color: var(--color-text-secondary);
}

/* Media Gallery Tabs */
.media-gallery-tabs {
  display: flex;
  gap: 0.5rem;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--color-border);
  background: var(--color-bg-primary);
}

.dark .media-gallery-tabs {
  background: var(--color-bg-secondary);
}

.media-tab {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 1rem;
  background: none;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  color: var(--color-text-secondary);
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}

.media-tab:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-primary);
  color: var(--color-text-primary);
}

.media-tab.active {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

.dark .media-tab:hover {
  background: var(--color-bg-tertiary);
}

/* Media Gallery Content */
.media-gallery-content {
  flex: 1;
  overflow-y: auto;
  padding: 1.5rem;
  min-height: 400px;
}

/* Loading State */
.media-gallery-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 1rem;
  color: var(--color-text-secondary);
}

.media-gallery-loading .spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* Empty State */
.media-gallery-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 1rem;
  color: var(--color-text-secondary);
}

.media-gallery-empty svg {
  opacity: 0.3;
}

/* Media Gallery Grid (Images) */
.media-gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 1rem;
}

.media-gallery-item {
  aspect-ratio: 1;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  position: relative;
  background: var(--color-bg-secondary);
  transition: transform 0.2s;
}

.media-gallery-item:hover {
  transform: scale(1.05);
}

.media-gallery-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.media-item-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
  padding: 1rem 0.75rem 0.75rem;
  opacity: 0;
  transition: opacity 0.2s;
}

.media-gallery-item:hover .media-item-overlay {
  opacity: 1;
}

.media-item-name {
  display: block;
  color: white;
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.media-item-date {
  display: block;
  color: rgba(255, 255, 255, 0.7);
  font-size: 11px;
  margin-top: 2px;
}

/* Media Gallery Files List */
.media-gallery-files {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.media-file-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: 12px;
  text-decoration: none;
  color: inherit;
  transition: all 0.2s;
}

.media-file-item:hover {
  background: var(--color-bg-tertiary);
  border-color: var(--color-primary);
  transform: translateX(4px);
}

.dark .media-file-item {
  background: var(--color-bg-tertiary);
}

.dark .media-file-item:hover {
  background: rgba(var(--color-primary-rgb), 0.1);
}

.media-file-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: var(--color-bg-primary);
  border-radius: 8px;
  color: var(--color-primary);
  flex-shrink: 0;
}

.dark .media-file-icon {
  background: var(--color-bg-secondary);
}

.media-file-info {
  flex: 1;
  min-width: 0;
}

.media-file-name {
  display: block;
  font-weight: 500;
  color: var(--color-text-primary);
  margin-bottom: 0.25rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.media-file-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 12px;
  color: var(--color-text-secondary);
}

.media-file-download {
  color: var(--color-text-secondary);
  transition: color 0.2s;
}

.media-file-item:hover .media-file-download {
  color: var(--color-primary);
}

/* Responsive */
@media (max-width: 768px) {
  .media-gallery-overlay {
    padding: 0;
  }

  .media-gallery {
    max-width: 100%;
    max-height: 100vh;
    border-radius: 0;
  }

  .media-gallery-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.75rem;
  }

  .media-gallery-content {
    padding: 1rem;
  }
}

/* Spin animation */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ============================================
   AUDIO PLAYER SIMPLE - USA COLORES DE LA BURBUJA
   ============================================ */

.attachment-audio-modern {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0;
  /* SIN background propio - usa el color de la burbuja */
}

/* Botón play/pause - adapta a contexto del mensaje */
.audio-play-btn-modern {
  flex-shrink: 0;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  background: rgba(255, 255, 255, 0.25);
  color: white;
}

/* En mensajes de otros, usar el color primario */
.message-bubble-container.other .audio-play-btn-modern {
  background: var(--color-primary, #5b6b8f);
  color: white;
}

.audio-play-btn-modern:hover {
  opacity: 0.9;
  transform: scale(1.05);
}

.audio-play-btn-modern:active {
  transform: scale(0.95);
}

/* Contenedor de progreso y tiempo */
.audio-progress-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  min-width: 100px;
}

/* Barra de progreso VISIBLE */
.audio-progress-modern {
  height: 4px;
  background: rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  cursor: pointer;
  overflow: hidden;
}

/* En mensajes propios (fondo azul) */
.message-bubble-container.own .audio-progress-modern {
  background: rgba(255, 255, 255, 0.3);
}

/* En mensajes de otros */
.message-bubble-container.other .audio-progress-modern {
  background: rgba(0, 0, 0, 0.1);
}

.progress-fill-modern {
  height: 100%;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 2px;
  transition: width 0.1s linear;
}

/* Fill en mensajes de otros */
.message-bubble-container.other .progress-fill-modern {
  background: var(--color-primary, #5b6b8f);
}

/* Tiempo del audio - SIN "/" en el medio */
.audio-time-modern {
  display: flex;
  gap: 0.25rem;
  font-size: 10px;
  color: currentColor;
  opacity: 0.75;
}

/* En mensajes propios (texto blanco sobre azul) */
.message-bubble-container.own .audio-time-modern {
  color: white;
}

/* ============================================
   RESPONSIVE CARD GRID - Auto-fit Layout
   ============================================

   Solución responsive para grids de tarjetas:
   - Las tarjetas automáticamente "caen" a la siguiente fila cuando no hay espacio
   - Nunca se aplastan por debajo del ancho mínimo definido
   - No requiere breakpoints manuales

   Uso:
   <div className="grid-responsive-cards gap-4">
     <Card />
     <Card />
   </div>
*/

@layer utilities {
  /* Tamaño estándar para tarjetas medianas (280px min) */
  .grid-responsive-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  /* Tarjetas pequeñas (200px min) - Para cards compactas */
  .grid-responsive-cards-sm {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  /* Tarjetas grandes (320px min) - Para cards con más contenido */
  .grid-responsive-cards-lg {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  }

  /* Tarjetas extra grandes (400px min) - Para dashboard cards */
  .grid-responsive-cards-xl {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  }

  /* Tarjetas extra pequeñas (150px min) - Para iconos o mini cards */
  .grid-responsive-cards-xs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}

/* Footer del audio: hora y tilde A LA DERECHA en la misma línea */
.audio-message-footer {
  display: flex;
  align-items: center;
  gap: 3px;
  margin-left: auto;
  flex-shrink: 0;
}

/* ============================================
   VOICE RECORDER INTEGRADO EN EL INPUT
   ============================================ */

/* Timer de grabación - grande y negrita dentro del textarea */
.voice-recording-timer {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  height: 100%;
  min-height: 50px;
  padding: 1rem;
  background: var(--color-bg-primary);
}

.recording-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #ef4444;
  animation: pulse-red 1.5s ease-in-out infinite;
}

@keyframes pulse-red {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.6;
    transform: scale(1.2);
  }
}

.timer-text {
  font-size: 1.5rem;
  font-weight: 700;
  font-family: ui-monospace, 'Cascadia Code', monospace;
  color: #ef4444;
}

/* Preview player dentro del textarea */
.voice-preview-player {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  height: 100%;
  min-height: 50px;
  padding: 0.75rem 1rem;
  background: var(--color-bg-primary);
}

.preview-play-btn {
  flex-shrink: 0;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  background: var(--color-primary, #6366f1);
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.preview-play-btn:hover {
  opacity: 0.9;
  transform: scale(1.05);
}

.preview-progress-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  min-width: 0;
}

.preview-progress-bar {
  height: 4px;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 2px;
  cursor: pointer;
  overflow: hidden;
}

.dark .preview-progress-bar {
  background: rgba(255, 255, 255, 0.1);
}

.preview-progress-fill {
  height: 100%;
  background: var(--color-primary, #6366f1);
  border-radius: 2px;
}

.preview-time {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: var(--color-text-secondary);
}

/* Botones de voz contextuales */
.voice-stop-button {
  min-width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #f97316;
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.voice-stop-button:hover {
  background: #ea580c;
  transform: scale(1.05);
}

.voice-cancel-button {
  min-width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.voice-cancel-button:hover {
  background: var(--color-bg-secondary);
  transform: scale(1.05);
}
