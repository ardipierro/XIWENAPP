╔═══════════════════════════════════════════════════════════════════════════════╗
║                    ARQUITECTURA DE CHUNKS - XIWENAPP                         ║
║                           Bundle Structure                                    ║
╚═══════════════════════════════════════════════════════════════════════════════╝

VISTA GENERAL DEL BUNDLE:

┌─────────────────────────────────────────────────────────────────────────────┐
│                     NAVEGADOR (Initial Load)                                │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │  Entry Bundle (index-CMKIOeZj.js)                              80 KB │  │
│  │  ├─ App.jsx                                                         │  │
│  │  ├─ main.jsx                                                       │  │
│  │  └─ Router setup                                                  │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                  │                                           │
│  ┌────────────────────┬──────────┴──────────┬──────────────────────┐        │
│  │                    │                     │                      │        │
│  ▼                    ▼                     ▼                      ▼        │
│ ┌──────────────────┐ ┌──────────────┐ ┌─────────────┐ ┌──────────────────┐ │
│ │ vendor-react     │ │vendor-firebase│ │vendor-other │ │ vendor-tiptap  │ │
│ │ (React core)     │ │(Firebase SDK) │ │ ❌ CRÍTICO  │ │(Tiptap Editor) │ │
│ │                  │ │               │ │             │ │                  │ │
│ │ 436 KB           │ │ 502 KB        │ │ 1.2 MB !!!  │ │ 119 KB           │ │
│ │ (100 KB gzip)    │ │ (120 KB gzip) │ │ (300 KB gz) │ │ (25 KB gzip)     │ │
│ └──────────────────┘ └──────────────┘ └─────────────┘ └──────────────────┘ │
│                                                                              │
│ ┌──────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│ │vendor-recharts│ │vendor-dndkit│ │ vendor-...  │ │ index.css   │          │
│ │(Charts)       │ │(Drag/Drop)  │ │ (Other libs)│ │ (CSS)       │          │
│ │               │ │             │ │             │ │             │          │
│ │ 220 KB        │ │ 45 KB       │ │ ...         │ │ varies      │          │
│ │ (50 KB gzip)  │ │ (9 KB gzip) │ │             │ │             │          │
│ └──────────────┘ └─────────────┘ └─────────────┘ └─────────────┘          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

TOTAL INITIAL LOAD: ~3.1 MB (sin gzip) → 750-850 KB (con gzip)

═══════════════════════════════════════════════════════════════════════════════

CONTENIDO DETALLADO DE vendor-other (1.2 MB) ❌ PROBLEMA:

┌─────────────────────────────────────────────────────────────────────────────┐
│  vendor-other-CHRnA3ZD.js (1.2 MB)                                          │
│  ├─ html2canvas (180 KB) ❌ SHOULD BE LAZY                                 │
│  │  └─ Usado en: EnhancedTextEditor.jsx (export to PDF)                   │
│  │     Llamado: onClick en botón "Exportar"                               │
│  │     Impacto: Cargado en TODAS las rutas pero usado en <5%              │
│  │                                                                          │
│  ├─ jsPDF (80 KB) ❌ SHOULD BE LAZY                                       │
│  │  └─ Usado en: pdfExport.js (PDF generation)                           │
│  │     Llamado: Cuando exportToPDF() es llamado                           │
│  │     Impacto: Cargado en TODAS las rutas pero usado en <5%              │
│  │                                                                          │
│  ├─ perfect-freehand (30 KB) ❌ SHOULD BE LAZY                            │
│  │  └─ Usado en: DrawingCanvas.jsx, DrawingCanvasAdvanced.jsx, etc       │
│  │     Llamado: Componentes de dibujo                                    │
│  │     Impacto: Cargado en TODAS las rutas pero usado solo en diarios    │
│  │                                                                          │
│  ├─ lucide-react (100+ KB)                                                │
│  │  └─ Usado en: Muchos componentes (iconos)                             │
│  │     Impacto: CRÍTICO - se usa en casi todos lados (BIEN)              │
│  │                                                                          │
│  ├─ Tailwind CSS (100-150 KB)                                            │
│  │  └─ Utilidades de CSS (no tree-shaken agresivamente)                  │
│  │     Impacto: Podría optimizarse más                                   │
│  │                                                                          │
│  └─ Otros módulos no categorizados (300+ KB)                             │
│     └─ Dependencias transitivas, helpers, etc                            │
│        Impacto: Requiere análisis con visualizer                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

RUTA DE CARGA - DASHBOARD (Ejemplo):

1. Usuario accede a http://app.com/
   │
   ├─► Descarga: index-CMKIOeZj.js (80 KB)
   │
   ├─► Descarga en paralelo:
   │   ├─ vendor-react (436 KB)     [React core]
   │   ├─ vendor-firebase (502 KB)  [Firebase]
   │   ├─ vendor-other (1.2 MB) ❌  [PDF, Canvas, Icons, etc]
   │   └─ vendor-tiptap (119 KB)    [Editor]
   │
   ├─► Renderiza App + Suspense fallback
   │
   └─► Usuario hace clic en "Diarios de Clase"
       │
       ├─► Descarga: ClassDailyLogManager-Drz30Xpc.js (82 KB)
       │   ├─ Importa: EnhancedTextEditor.jsx
       │   │  └─ Que importa: pdfExport.js
       │   │     └─ Que importa: html2canvas + jsPDF ❌ PROBLEMA
       │   │        Estos ya están cargados en vendor-other
       │
       └─► Renderiza ClassDailyLogManager

═══════════════════════════════════════════════════════════════════════════════

RUTA DE CARGA - EXPORTAR PDF (Ejemplo):

ACTUAL (INEFICIENTE):
─────────────────────
1. Bundle cargado
   └─ vendor-other (1.2 MB) incluye html2canvas + jsPDF
      ├─ Descargado INMEDIATAMENTE (incluso si nunca se usa)
      └─ Toma ~200-300ms en 3G

2. Usuario abre diario y edita contenido
   └─ Sin hacer nada con PDF (60% de usuarios)

3. Usuario hace clic en "Exportar PDF"
   └─ Librería ya está cargada (ventaja mínima)

OPTIMIZADO (PROPUESTO):
──────────────────────
1. Bundle cargado
   └─ vendor-other (900 KB) SIN html2canvas ni jsPDF
      ├─ Descargado: ~20% más rápido
      └─ Ahorrada: ~260 KB

2. Usuario abre diario y edita contenido
   └─ Sin hacer nada con PDF (cero overhead)

3. Usuario hace clic en "Exportar PDF"
   └─ Lazy carga: pdf-utils-chunk.js (260 KB)
      ├─ Se descarga bajo demanda
      ├─ Tiempo total: MÁS RÁPIDO en la mayoría de casos
      └─ Es invisible para el usuario (async)

═══════════════════════════════════════════════════════════════════════════════

LAZY-LOADED CHUNKS (Route-based):

┌──────────────────────────────────────────────────────────────────────────┐
│  UniversalDashboard-hvb6Guq2.js (104 KB)                                │
│  ├─ Dashboard principal                                                 │
│  ├─ Lazy componentes dentro:                                            │
│  │  ├─ UnifiedCalendar (30 KB)                                          │
│  │  ├─ MessagesPanel (53 KB)                                            │
│  │  ├─ ContentManagerTabs (373 KB) ◄── GRANDE pero lazy                │
│  │  ├─ ClassDailyLogManager (82 KB) ◄── Contiene EnhancedTextEditor   │
│  │  ├─ AdminPaymentsPanel (14 KB)                                       │
│  │  ├─ SettingsPanel (95 KB)                                            │
│  │  └─ [... 50+ más componentes lazy loaded]                            │
│  │                                                                       │
│  └─ Resultado: Usuario solo descarga componentes que ve                │
│                                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│ Excalidraw Whiteboard (500 KB)                                          │
│ └─ Lazy loaded solo cuando se abre una sesión de whiteboard            │
│    Bien implementado ✅                                                 │
│                                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│ TestPage (66 KB)                                                        │
│ └─ Lazy loaded solo cuando se accede                                    │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

PROPUESTA DE REFACTORIZACIÓN:

ANTES:
vendor-other (1.2 MB)
├─ html2canvas (180 KB)
├─ jsPDF (80 KB)
├─ perfect-freehand (30 KB)
├─ lucide-react (100+ KB)
├─ Tailwind (100+ KB)
└─ Otros (600+ KB)

DESPUÉS:
vendor-other (900 KB)
├─ lucide-react (100+ KB)
├─ Tailwind (100+ KB)
└─ Otros (600+ KB)

LAZY CHUNKS:
├─ vendor-pdf.js (260 KB)
│  └─ html2canvas + jsPDF
│     Cargado: onClick "Exportar PDF"
│
└─ vendor-canvas.js (30 KB)
   └─ perfect-freehand
      Cargado: Cuando se abre DrawingCanvas

GANANCIA:
- Initial bundle: 1.2 MB → 900 KB (-300 KB)
- Con gzip: 300 KB → 210 KB (-90 KB)
- FCP: +25-35% más rápido
- LCP: +15-20% más rápido

═══════════════════════════════════════════════════════════════════════════════
